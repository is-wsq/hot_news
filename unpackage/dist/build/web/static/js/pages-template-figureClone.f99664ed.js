(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-template-figureClone"],{"0821":function(e,t,i){var n=i("c86c");t=n(!1),t.push([e.i,".loading-container[data-v-610b468f]{position:fixed;top:0;left:0;width:100%;height:100%;display:flex;justify-content:center;align-items:center;background-color:rgba(0,0,0,.5);z-index:9999}.loading-wrapper[data-v-610b468f]{display:flex;flex-direction:column;align-items:center;justify-content:center;max-width:180px;background-color:rgba(0,0,0,.5);border-radius:10px;padding:20px}.loading-video[data-v-610b468f]{width:100px;height:85px}.loading-text[data-v-610b468f]{color:#fff;margin-top:15px;font-size:16px}",""]),e.exports=t},"19bc":function(e,t,i){"use strict";i.r(t);var n=i("2c99"),a=i.n(n);for(var o in n)["default"].indexOf(o)<0&&function(e){i.d(t,e,(function(){return n[e]}))}(o);t["default"]=a.a},"20f3":function(e,t,i){"use strict";var n=i("8bdb"),a=i("5145");n({target:"Array",proto:!0,forced:a!==[].lastIndexOf},{lastIndexOf:a})},"29e7":function(e,t,i){"use strict";i.r(t);var n=i("3f39"),a=i("e3a0");for(var o in a)["default"].indexOf(o)<0&&function(e){i.d(t,e,(function(){return a[e]}))}(o);i("cf13");var r=i("828b"),s=Object(r["a"])(a["default"],n["b"],n["c"],!1,null,"64bc1f67",null,!1,n["a"],void 0);t["default"]=s.exports},"2c99":function(e,t,i){"use strict";i("6a54"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={props:{text:{type:String,default:"Loading..."}},methods:{playVideo:function(){this.$refs.video.play()}}};t.default=n},"3f39":function(e,t,i){"use strict";i.d(t,"b",(function(){return a})),i.d(t,"c",(function(){return o})),i.d(t,"a",(function(){return n}));var n={uniIcons:i("00f9").default,uniPopup:i("3182").default},a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-uni-view",{staticClass:"pages figureClone"},[i("v-uni-view",{staticClass:"nav-bar-header"},[i("uni-icons",{staticClass:"nav-bar-back",attrs:{type:"left",size:"21",color:"#ffffff"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.back.apply(void 0,arguments)}}}),i("v-uni-view",{staticClass:"nav-bar-title"},[e._v("形象克隆")]),i("v-uni-view",{staticClass:"figure-list",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.gotoFigures.apply(void 0,arguments)}}},[e._v("形象列表")])],1),i("v-uni-view",{staticClass:"figure-content"},[i("v-uni-view",{staticStyle:{"margin-bottom":"15px"}},[e._v("正确示例")]),i("v-uni-view",{staticStyle:{display:"flex"}},[i("v-uni-view",{staticClass:"template-img"}),i("v-uni-view",{staticClass:"template-requires"},e._l(e.requires,(function(t,n){return i("v-uni-view",{key:n,staticStyle:{height:"40px",display:"flex","align-items":"center"}},[i("uni-icons",{staticStyle:{margin:"0 5px"},attrs:{type:"checkbox-filled",size:"22",color:"#77C285"}}),i("v-uni-view",{staticStyle:{"font-size":"14px"}},[e._v(e._s(t))])],1)})),1)],1),i("v-uni-view",{staticStyle:{margin:"15px 0"}},[e._v("错误示例")]),i("v-uni-view",{staticStyle:{display:"flex",gap:"15px"}},e._l(e.errors,(function(t,n){return i("v-uni-view",{key:n},[i("v-uni-view",{staticClass:"error-img",style:{width:e.errorWidth+"px",height:e.errorHeight+"px",backgroundImage:"url("+t.img+")"}},[i("v-uni-view",{staticStyle:{position:"absolute",bottom:"0",right:"0"}},[i("uni-icons",{attrs:{type:"clear",size:"20",color:"#BD3124"}})],1)],1),i("v-uni-view",{staticStyle:{width:"100%","text-align":"center","margin-top":"5px"}},[e._v(e._s(t.name))])],1)})),1),i("v-uni-view",{staticStyle:{margin:"15px 0"}},[e._v("视频教程")]),i("v-uni-video",{staticStyle:{width:"100%",height:"200px"},attrs:{src:e.src,poster:e.poster}})],1),i("v-uni-view",{staticClass:"figure-footer"},[i("v-uni-button",{staticClass:"clone-button",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.startClone.apply(void 0,arguments)}}},[e._v("开始克隆")])],1),i("uni-popup",{ref:"clonePopup",staticStyle:{width:"100%"},attrs:{"mask-click":!1,type:"center"}},[i("v-uni-view",{staticClass:"clone-content",style:{width:.8*e.contentWidth+"px"}},[i("v-uni-view",{staticClass:"clone-title"},[e._v("克隆形象")]),i("v-uni-view",{staticStyle:{padding:"10px 20px","box-sizing":"border-box"}},[e.selectedFile?i("v-uni-view",{staticStyle:{display:"flex"}},[i("v-uni-view",{staticClass:"file-name"},[e._v(e._s(e.selectedFile.name))]),i("uni-icons",{staticStyle:{"margin-left":"10px","line-height":"38px"},attrs:{type:"trash-filled",size:"20",color:"#9a9a9a"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.selectedFile=null}}})],1):i("v-uni-view",{staticStyle:{"text-align":"center"}},[i("v-uni-button",{staticStyle:{"font-size":"14px"},attrs:{size:"mini"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.selectFile.apply(void 0,arguments)}}},[e._v("选择文件")])],1),i("v-uni-view",{staticStyle:{"margin-top":"10px",display:"flex","align-items":"center"}},[i("v-uni-checkbox-group",{on:{change:function(t){arguments[0]=t=e.$handleEvent(t),e.cloneSound=!e.cloneSound}}},[i("v-uni-checkbox",{staticStyle:{transform:"scale(0.7)"},attrs:{color:"#42B983"}})],1),i("v-uni-view",{staticStyle:{"font-size":"14px",color:"#000000"}},[e._v("同时克隆声音")])],1)],1),i("v-uni-view",{staticStyle:{display:"flex","margin-top":"10px"}},[i("v-uni-view",{staticClass:"clone-btn",staticStyle:{"border-right":"1px solid #f5f5f5",color:"#000000"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.clonePopupClose.apply(void 0,arguments)}}},[e._v("取消")]),i("v-uni-view",{staticClass:"clone-btn",staticStyle:{color:"#007aff"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.uploadFile.apply(void 0,arguments)}}},[e._v("克隆")])],1)],1)],1),e.isLoading?i("loading-video",{ref:"loadingVideo",attrs:{text:"视频上传中，请勿离开"}}):e._e()],1)},o=[]},"54be":function(e,t,i){"use strict";i("6a54");var n=i("f5bd").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,i("bf0f"),i("9327"),i("20f3"),i("c223"),i("c9b5"),i("ab80");i("8f59");var a=n(i("87c3")),o="Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJodHRwczovL2xpdmUudGVsbGFpLnRlY2giLCJzdWIiOiI3ODNjNGI1NC1hMWQwLTVmY2ItOTExZC1kNWM1YjNjODY2MTAiLCJpYXQiOjE3NDIyMTA0NDQsImV4cCI6MTc1OTc5NTIwMCwibmFtZSI6InRlc3QifQ.OGrW6VfdM7zLVcGjGz9UHblQQlQoHWSriFB90kJOq98",r={name:"figureClone",components:{LoadingVideo:a.default},data:function(){return{requires:["提交1-3分钟的视频片段","使用高分辨率相机和麦克风","录制环境光线充足、安静","保持人物一直在画框中","直视镜头","适当配合通用手势"],errors:[{name:"遮住嘴巴",img:"/static/img/error_v1.jpeg"},{name:"人脸出框",img:"/static/img/error_v2.jpeg"},{name:"侧脸拍摄",img:"/static/img/error_v3.jpeg"}],contentWidth:0,errorWidth:0,errorHeight:0,src:"https://qiniu-web-assets.dcloud.net.cn/unidoc/zh/2minute-demo.mp4",poster:"https://www.w3schools.com/images/w3schools_green.jpg",selectedFile:null,cloneSound:!1,uploadUrl:"",fileId:"",isLoading:!1}},mounted:function(){this.contentWidth=uni.getSystemInfoSync().safeArea.width-20,this.errorWidth=(uni.getSystemInfoSync().safeArea.width-50)/3,this.errorHeight=4*this.errorWidth/3},methods:{startClone:function(){this.getFileId(),this.$refs.clonePopup.open()},selectFile:function(){var e=this;uni.chooseFile({count:1,success:function(t){var i=t.tempFiles[0].name.toLowerCase(),n=[".mp4",".mov"].some((function(e){return i.toLowerCase().endsWith(e)}));n?e.selectedFile=t.tempFiles[0]:e.$tip.confirm("请选择有效的视频文件,mp4或mov格式",!1)}})},clonePopupClose:function(){this.selectedFile=null,this.cloneSound=!1,this.$refs.clonePopup.close()},getFileId:function(){var e=this,t=this;uni.request({url:"https://live.tellai.tech/api/media/files/upload_request?type=video",header:{Authorization:o},success:function(i){var n=i.data.base_resp,a=i.data.data;200===n.status_code?(t.uploadUrl=a.upload_url,t.fileId=a.file_id):e.$tip.confirm(n.status_msg,!1)}})},uploadFile:function(){var e=this;e.$refs.clonePopup.close();var t={type:"figures",id:e.generateUniqueId(),name:e.selectedFile.name};e.isLoading=!0,e.$nextTick((function(){e.$refs.loadingVideo.playVideo()})),uni.uploadFile({url:e.uploadUrl,filePath:e.selectedFile.path,name:"file",header:{Authorization:o},timeout:18e5,formData:{file_id:e.fileId,type:"video"},success:function(i){var n=JSON.parse(i.data).base_resp,a=JSON.parse(i.data).data;200===n.status_code?(e.isLoading=!1,e.$store.dispatch("task/addTask",t),e.$tip.confirm("视频上传成功，已创建形象克隆任务\n《".concat(e.selectedFile.name,"》"),!1).then((function(e){uni.redirectTo({url:"/pages/template/figures"})})),e.clone(a.file_id,t)):(e.isLoading=!1,e.$tip.confirm("视频上传失败,".concat(n.status_msg),!1))}})},clone:function(e,t){var i=this,n={user_id:uni.getStorageSync("userId"),file_id:e,video_name:t.name.substring(0,t.name.lastIndexOf(".")),cloneSound:this.cloneSound};this.$http.post("/figure/clone/file_id",n,18e5).then((function(e){i.$store.dispatch("task/removeTask",t.id),"success"===e.status?i.$tip.confirm("".concat(t.name,"形象克隆任务成功"),!1):i.$tip.confirm("".concat(t.name,"形象克隆任务失败,").concat(e.message),!1)}))},generateUniqueId:function(){return Date.now()+Math.random().toString(36).substr(2,16)},back:function(){uni.switchTab({url:"/pages/template/index"})},gotoFigures:function(){uni.redirectTo({url:"/pages/template/figures"})}}};t.default=r},"5e39":function(e,t,i){"use strict";var n=i("c7d9"),a=i.n(n);a.a},"70a3":function(e,t,i){var n=i("ad40");n.__esModule&&(n=n.default),"string"===typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);var a=i("967d").default;a("6da3e829",n,!0,{sourceMap:!1,shadowMode:!1})},"87c3":function(e,t,i){"use strict";i.r(t);var n=i("d095"),a=i("19bc");for(var o in a)["default"].indexOf(o)<0&&function(e){i.d(t,e,(function(){return a[e]}))}(o);i("5e39");var r=i("828b"),s=Object(r["a"])(a["default"],n["b"],n["c"],!1,null,"610b468f",null,!1,n["a"],void 0);t["default"]=s.exports},9327:function(e,t,i){"use strict";var n=i("8bdb"),a=i("9f69"),o=i("1ded").f,r=i("c435"),s=i("9e70"),c=i("b6a1"),l=i("862c"),u=i("0931"),d=i("a734"),f=a("".slice),p=Math.min,v=u("endsWith"),g=!d&&!v&&!!function(){var e=o(String.prototype,"endsWith");return e&&!e.writable}();n({target:"String",proto:!0,forced:!g&&!v},{endsWith:function(e){var t=s(l(this));c(e);var i=arguments.length>1?arguments[1]:void 0,n=t.length,a=void 0===i?n:p(r(i),n),o=s(e);return f(t,a-o.length,a)===o}})},ad40:function(e,t,i){var n=i("c86c");t=n(!1),t.push([e.i,".figureClone[data-v-64bc1f67]{height:100vh;color:#fff}.figure-list[data-v-64bc1f67]{position:absolute;right:5px;color:#fff}.figure-content[data-v-64bc1f67]{height:calc(100% - 135px);overflow-y:auto}.template-img[data-v-64bc1f67]{background-image:url(/static/img/correct.jpeg);border-radius:10px;width:180px;height:240px;margin-right:5px;background-size:cover;background-repeat:no-repeat;background-position:50%}.figure-footer[data-v-64bc1f67]{height:70px;display:flex;justify-content:center;align-items:center}.clone-button[data-v-64bc1f67]{width:250px;height:40px;line-height:40px;color:#101010;border-radius:10px;background-color:#e99d42}.error-img[data-v-64bc1f67]{position:relative;border-radius:10px;background-size:cover;background-repeat:no-repeat;background-position:50%}.clone-content[data-v-64bc1f67]{background:#fff;border-radius:11px;padding-top:15px;box-sizing:border-box}.clone-title[data-v-64bc1f67]{font-size:16px;font-weight:500;color:#909399;text-align:center}.file-name[data-v-64bc1f67]{font-size:14px;line-height:36px;flex:1;white-space:nowrap;color:#000;overflow:hidden;text-overflow:ellipsis}.clone-btn[data-v-64bc1f67]{flex:1;height:50px;line-height:50px;text-align:center;font-size:16px;border-radius:0 0 0 11px;border-top:1px solid #f5f5f5}",""]),e.exports=t},c7d9:function(e,t,i){var n=i("0821");n.__esModule&&(n=n.default),"string"===typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);var a=i("967d").default;a("8200160e",n,!0,{sourceMap:!1,shadowMode:!1})},cf13:function(e,t,i){"use strict";var n=i("70a3"),a=i.n(n);a.a},d095:function(e,t,i){"use strict";i.d(t,"b",(function(){return n})),i.d(t,"c",(function(){return a})),i.d(t,"a",(function(){}));var n=function(){var e=this.$createElement,t=this._self._c||e;return t("v-uni-view",{staticClass:"loading-container"},[t("v-uni-view",{staticClass:"loading-wrapper"},[t("v-uni-video",{ref:"video",staticClass:"loading-video",attrs:{src:"/static/loading.mp4",playsinline:!0,"webkit-playsinline":!0,loop:!0,muted:!0,"object-fit":"cover",controls:!1,"show-center-play-btn":!1}}),t("v-uni-view",{staticClass:"loading-text"},[this._v(this._s(this.text))])],1)],1)},a=[]},e3a0:function(e,t,i){"use strict";i.r(t);var n=i("54be"),a=i.n(n);for(var o in n)["default"].indexOf(o)<0&&function(e){i.d(t,e,(function(){return n[e]}))}(o);t["default"]=a.a}}]);