(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-template-recorder"],{"0b46":function(e,t,n){"use strict";var r=n("6a50");r("Int8",(function(e){return function(t,n,r){return e(this,t,n,r)}}))},"0e66":function(e,t,n){"use strict";n.r(t);var r=n("5d97"),a=n.n(r);for(var o in r)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(o);t["default"]=a.a},"20f3":function(e,t,n){"use strict";var r=n("8bdb"),a=n("5145");r({target:"Array",proto:!0,forced:a!==[].lastIndexOf},{lastIndexOf:a})},"2d48":function(e,t,n){"use strict";var r=n("6a50");r("Int16",(function(e){return function(t,n,r){return e(this,t,n,r)}}))},"395d":function(e,t,n){var r=n("6577");r.__esModule&&(r=r.default),"string"===typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);var a=n("967d").default;a("2f3b7b3e",r,!0,{sourceMap:!1,shadowMode:!1})},"4ec3":function(e,t,n){(function(e){var r,a=n("bdbb").default;n("d4b5"),n("aa9c"),n("dd2b"),n("4db2"),n("bf0f"),n("2d48"),n("4d8f"),n("7b97"),n("668a"),n("c5b7"),n("8ff5"),n("2378"),n("641a"),n("64e0"),n("cce3"),n("efba"),n("d009"),n("bd7d"),n("7edd"),n("d798"),n("f547"),n("5e54"),n("b60a"),n("8c18"),n("12973"),n("f991"),n("198e"),n("8557"),n("63b1"),n("1954"),n("1cf1"),n("5c47"),n("a1c1"),n("c9b5"),n("ab80"),n("4f9b"),n("f7a5"),n("d5c6"),n("5a56"),n("f074"),n("c976"),n("8f71"),n("0506"),n("0b46"),n("c02e"),n("80e3"),n("dc69"),n("825c"),n("e966"),n("7a76"),n("5ef2"),function(o){var i="object"==("undefined"===typeof window?"undefined":a(window))&&!!window.document,s=i?window:Object;!function(e,t){"use strict";var n=function(){},r=function(e){return"number"==typeof e},o=function(e){return JSON.stringify(e)},i=function(e){return new U(e)},s=i.LM="2025-01-11 09:28",c="https://github.com/xiangyuecn/Recorder",u="Recorder",f="getUserMedia",l="srcSampleRate",v="sampleRate",d="bitRate",p="catch",h=e[u];if(h&&h.LM==s)return h.CLog(h.i18n.$T("K8zP::重复导入{1}",0,u),3);i.IsOpen=function(){var e=i.Stream;if(e){var t=T(e),n=t[0];if(n){var r=n.readyState;return"live"==r||r==n.LIVE}}return!1},i.BufferSize=4096,i.Destroy=function(){for(var e in A(u+" Destroy"),I(),g)g[e]()};var g={};i.BindDestroy=function(e,t){g[e]=t},i.Support=function(){if(!t)return!1;var e=navigator.mediaDevices||{};return e[f]||(e=navigator)[f]||(e[f]=e.webkitGetUserMedia||e.mozGetUserMedia||e.msGetUserMedia),!!e[f]&&(i.Scope=e,!!i.GetContext())},i.GetContext=function(e){if(!t)return null;var n=window.AudioContext;if(n||(n=window.webkitAudioContext),!n)return null;var r=i.Ctx,a=0;return r||(r=i.Ctx=new n,a=1,i.NewCtxs=i.NewCtxs||[],i.BindDestroy("Ctx",(function(){var e=i.Ctx;e&&e.close&&(m(e),i.Ctx=0);var t=i.NewCtxs;i.NewCtxs=[];for(var n=0;n<t.length;n++)m(t[n])}))),e&&r.close&&(a||(r._useC||m(r),r=new n),r._useC=1,i.NewCtxs.push(r)),r},i.CloseNewCtx=function(e){if(e&&e.close){m(e);for(var t=i.NewCtxs||[],n=t.length,r=0;r<t.length;r++)if(t[r]==e){t.splice(r,1);break}A(W("mSxV::剩{1}个GetContext未close",0,n+"-1="+t.length),t.length?3:0)}};var m=function(e){if(e&&e.close&&!e._isC&&(e._isC=1,"closed"!=e.state))try{e.close()}catch(e){A("ctx close err",1,e)}},b=i.ResumeCtx=function(e,t,n,r){var a=0,o=0,i=0,s=0,c="EventListener",u="ResumeCtx ",f=function(t,u){o&&l(),a||(a=1,t&&r(t,s),u&&n(s)),u&&(!e._LsSC&&e["add"+c]&&e["add"+c]("statechange",v),e._LsSC=1,i=1)},l=function(e){if(!e||!o){o=e?1:0;for(var t=["focus","mousedown","mouseup","touchstart","touchend"],n=0;n<t.length;n++)window[(e?"add":"remove")+c](t[n],v,!0)}},v=function(){var n=e.state,r=_(n);if(!a&&!t(r?++s:s))return f();r?(i&&A(u+"sc "+n,3),l(1),e.resume().then((function(){i&&A(u+"sc "+e.state),f(0,1)}))[p]((function(t){A(u+"error",1,t),_(e.state)||f(t.message||"error")}))):"closed"==n?(i&&!e._isC&&A(u+"sc "+n,1),f("ctx closed")):f(0,1)};v()},_=i.CtxSpEnd=function(e){return"suspended"==e||"interrupted"==e},w=function(e){var t=e.state,n="ctx.state="+t;return _(t)&&(n+=W("nMIy::（注意：ctx不是running状态，rec.open和start至少要有一个在用户操作(触摸、点击等)时进行调用，否则将在rec.start时尝试进行ctx.resume，可能会产生兼容性问题(仅iOS)，请参阅文档中runningContext配置）")),n},C="ConnectEnableWebM";i[C]=!0;var y="ConnectEnableWorklet";i[y]=!1;var S=function(e){var t=e.BufferSize||i.BufferSize,n=e.Stream,r=n._c,a=r[v],s={},c=T(n),f=c[0],l=null,d="";if(f&&f.getSettings){var h=(l=f.getSettings())[v];h&&h!=a&&(d=W("eS8i::Stream的采样率{1}不等于{2}，将进行采样率转换（注意：音质不会变好甚至可能变差），主要在移动端未禁用回声消除时会产生此现象，浏览器有回声消除时可能只会返回16k采样率的音频数据，",0,h,a))}n._ts=l,A(d+"Stream TrackSet: "+o(l),d?3:0);var g,m,_,w=function(e){var t=n._m=r.createMediaStreamSource(n),a=r.destination,o="createMediaStreamDestination";r[o]&&(a=n._d=r[o]()),t.connect(e),e.connect(a)},S="",x=n._call,I=function(e,t){for(var n in x){if(t!=a){s.index=0;var r=(s=i.SampleData([e],t,a,s,{_sum:1})).data,o=s._sum}else{s={};for(var c=e.length,u=(r=new Int16Array(c),o=0,0);u<c;u++){var f=Math.max(-1,Math.min(1,e[u]));f=f<0?32768*f:32767*f,r[u]=f,o+=Math.abs(f)}}for(var l in x)x[l](r,o);return}},L="ScriptProcessor",O="audioWorklet",R=u+" "+O,U="RecProc",z="MediaRecorder",D=z+".WebM.PCM",E=r.createScriptProcessor||r.createJavaScriptNode,F=W("ZGlf::。由于{1}内部1秒375次回调，在移动端可能会有性能问题导致回调丢失录音变短，PC端无影响，暂不建议开启{1}。",0,O),P=function(){m=n.isWorklet=!1,M(n),A(W("7TU0::Connect采用老的{1}，",0,L)+G.get(W(i[y]?"JwCL::但已设置{1}尝试启用{2}":"VGjB::可设置{1}尝试启用{2}",2),[u+"."+y+"=true",O])+S+F,3);var e=n._p=E.call(r,t,1,1);w(e),e.onaudioprocess=function(e){var t=e.inputBuffer.getChannelData(0);I(t,a)}},$=function(){g=n.isWebM=!1,k(n),m=n.isWorklet=!E||i[y];var e=window.AudioWorkletNode;if(m&&r[O]&&e){var o=function(){return m&&n._na},s=n._na=function(){""!==_&&(clearTimeout(_),_=setTimeout((function(){_=0,o()&&(A(W("MxX1::{1}未返回任何音频，恢复使用{2}",0,O,L),3),E&&P())}),500))},c=function(){if(o()){var i=n._n=new e(r,U,{processorOptions:{bufferSize:t}});w(i),i.port.onmessage=function(e){_&&(clearTimeout(_),_=""),o()?I(e.data.val,a):m||A(W("XUap::{1}多余回调",0,O),3)},A(W("yOta::Connect采用{1}，设置{2}可恢复老式{3}",0,O,u+"."+y+"=false",L)+S+F,3)}},f=function(){if(o())if(r[U])c();else{var e,t,n=(t="class "+U+" extends AudioWorkletProcessor{",t+="constructor "+(e=function(e){return e.toString().replace(/^function|DEL_/g,"").replace(/\$RA/g,R)})((function(e){DEL_super(e);var t=this,n=e.processorOptions.bufferSize;t.bufferSize=n,t.buffer=new Float32Array(2*n),t.pos=0,t.port.onmessage=function(e){e.data.kill&&(t.kill=!0,$C.log("$RA kill call"))},$C.log("$RA .ctor call",e)})),t+="process "+e((function(e,t,n){var r=this,a=r.bufferSize,o=r.buffer,i=r.pos;if((e=(e[0]||[])[0]||[]).length){o.set(e,i);var s=~~((i+=e.length)/a)*a;if(s){this.port.postMessage({val:o.slice(0,s)});var c=o.subarray(s,i);(o=new Float32Array(2*a)).set(c),i=c.length,r.buffer=o}r.pos=i}return!r.kill})),t=(t+='}try{registerProcessor("'+U+'", '+U+')}catch(e){$C.error("'+R+' Reg Error",e)}').replace(/\$C\./g,"console."),"data:text/javascript;base64,"+btoa(unescape(encodeURIComponent(t))));r[O].addModule(n).then((function(e){o()&&(r[U]=1,c(),_&&s())}))[p]((function(e){A(O+".addModule Error",1,e),o()&&P()}))}};b(r,(function(){return o()}),f,f)}else P()};!function(){var e=window[z],r="ondataavailable",a="audio/webm; codecs=pcm";g=n.isWebM=i[C];var o=e&&r in e.prototype&&e.isTypeSupported(a);if(S=o?"":W("VwPd::（此浏览器不支持{1}）",0,D),!g||!o)return $();var s=function(){return g&&n._ra};n._ra=function(){""!==_&&(clearTimeout(_),_=setTimeout((function(){s()&&(A(W("vHnb::{1}未返回任何音频，降级使用{2}",0,z,O),3),$())}),500))};var c=Object.assign({mimeType:a},i.ConnectWebMOptions),f=n._r=new e(n,c),l=n._rd={};f[r]=function(e){var t=new FileReader;t.onloadend=function(){if(s()){var e=N(new Uint8Array(t.result),l);if(!e)return;if(-1==e)return void $();_&&(clearTimeout(_),_=""),I(e,l.webmSR)}else g||A(W("O9P7::{1}多余回调",0,z),3)},t.readAsArrayBuffer(e.data)};try{f.start(~~(t/48)),A(W("LMEm::Connect采用{1}，设置{2}可恢复使用{3}或老式{4}",0,D,u+"."+C+"=false",O,L))}catch(e){A("mr start err",1,e),$()}}()},x=function(e){e._na&&e._na(),e._ra&&e._ra()},M=function(e){e._na=null,e._n&&(e._n.port.postMessage({kill:!0}),e._n.disconnect(),e._n=null)},k=function(e){if(e._ra=null,e._r){try{e._r.stop()}catch(e){A("mr stop err",1,e)}e._r=null}},I=function(e){var t=(e=e||i)==i,n=e.Stream;n&&(n._m&&(n._m.disconnect(),n._m=null),!n._RC&&n._c&&i.CloseNewCtx(n._c),n._RC=null,n._c=null,n._d&&(L(n._d.stream),n._d=null),n._p&&(n._p.disconnect(),n._p.onaudioprocess=n._p=null),M(n),k(n),t&&L(n)),e.Stream=0},L=i.StopS_=function(e){for(var t=T(e),n=0;n<t.length;n++){var r=t[n];r.stop&&r.stop()}e.stop&&e.stop()},T=function(e){var t=0,n=0,r=[];e.getAudioTracks&&(t=e.getAudioTracks(),n=e.getVideoTracks()),t||(t=e.audioTracks,n=e.videoTracks);for(var a=0,o=t?t.length:0;a<o;a++)r.push(t[a]);for(a=0,o=n?n.length:0;a<o;a++)r.push(n[a]);return r};i.SampleData=function(e,t,n,r,a){var o="SampleData";r||(r={});var s=r.index||0,c=r.offset||0,u=r.raisePrev||0,f=r.filter;if(f&&f.fn&&(f.sr&&f.sr!=t||f.srn&&f.srn!=n)&&(f=null,A(W("d48C::{1}的filter采样率变了，重设滤波",0,o),3)),!f)if(n<=t){var l=3*t/4<n?0:n/2*3/4;f={fn:l?i.IIRFilter(!0,t,l):0}}else{l=3*n/4<t?0:t/2*3/4;f={fn:l?i.IIRFilter(!0,n,l):0}}f.sr=t,f.srn=n;var v=f.fn,d=r.frameNext||[];a||(a={});var p=a.frameSize||1;a.frameType&&(p="mp3"==a.frameType?1152:1);var h=a._sum,g=0,m=e.length;m+1<s&&A(W("tlbC::{1}似乎传入了未重置chunk {2}",0,o,s+">"+m),3);for(var b=0,_=s;_<m;_++)b+=e[_].length;var w=t/n;if(1<w)b=Math.max(0,b-Math.floor(c)),b=Math.floor(b/w);else if(w<1){var C=1/w;b=Math.floor(b*C)}b+=d.length;var y=new Int16Array(b),S=0;for(_=0;_<d.length;_++)y[S]=d[_],S++;for(;s<m;s++){var x=e[s],M=x instanceof Float32Array,k=(_=c,x.length),I=v&&v.Embed,L=0,T=0,O=0,R=0;if(w<1){for(var U=S+_,N=u,z=0;z<k;z++){var D=x[z];M&&(D=(D=Math.max(-1,Math.min(1,D)))<0?32768*D:32767*D);var E=Math.floor(U);U+=C;for(var F=Math.floor(U),G=(D-N)/(F-E),P=1;E<F;E++,P++){var $=Math.floor(N+P*G);I?(O=$,R=I.b0*O+I.b1*I.x1+I.b0*I.x2-I.a1*I.y1-I.a2*I.y2,I.x2=I.x1,I.x1=O,I.y2=I.y1,I.y1=R,$=R):$=v?v($):$,32767<$?$=32767:$<-32768&&($=-32768),h&&(g+=Math.abs($)),y[E]=$,S++}N=u=D,_+=C}c=_%1}else{z=0;for(var B=0;z<k;z++,B++){if(B<k){D=x[B];M&&(D=(D=Math.max(-1,Math.min(1,D)))<0?32768*D:32767*D),I?(O=D,R=I.b0*O+I.b1*I.x1+I.b0*I.x2-I.a1*I.y1-I.a2*I.y2,I.x2=I.x1,I.x1=O,I.y2=I.y1,I.y1=R):R=v?v(D):D}if(L=T,T=R,0!=B){var J=Math.floor(_);if(z==J){var j=Math.ceil(_),V=_-J,Q=L,H=j<k?T:Q,q=Q+(H-Q)*V;32767<q?q=32767:q<-32768&&(q=-32768),h&&(g+=Math.abs(q)),y[S]=q,S++,_+=w}}else z--}c=Math.max(0,_-k)}}w<1&&S+1==b&&(b--,y=new Int16Array(y.buffer.slice(0,2*b))),S-1!=b&&S!=b&&A(o+" idx:"+S+" != size:"+b,3),d=null;var X=b%p;if(0<X){var Y=2*(b-X);d=new Int16Array(y.buffer.slice(Y)),y=new Int16Array(y.buffer.slice(0,Y))}var K={index:s,offset:c,raisePrev:u,filter:f,frameNext:d,sampleRate:n,data:y};return h&&(K._sum=g),K},i.IIRFilter=function(e,t,n){var r=2*Math.PI*n/t,a=Math.sin(r),o=Math.cos(r),i=a/2,s=1+i,c=-2*o/s,u=(1-i)/s;if(e)var f=(1-o)/2/s,l=(1-o)/s;else f=(1+o)/2/s,l=-(1+o)/s;var v=0,d=0,p=0,h=0,g=0,m=function(e){return p=f*e+l*v+f*d-c*h-u*g,d=v,v=e,g=h,h=p};return m.Embed={x1:0,x2:0,y1:0,y2:0,b0:f,b1:l,a1:c,a2:u},m},i.PowerLevel=function(e,t){var n=e/t||0;return n<1251?Math.round(n/1250*10):Math.round(Math.min(100,Math.max(0,100*(1+Math.log(n/1e4)/Math.log(10)))))},i.PowerDBFS=function(e){var t=Math.max(.1,e||0);return t=Math.min(t,32767),t=20*Math.log(t/32767)/Math.log(10),Math.max(-100,Math.round(t))},i.CLog=function(e,t){if("object"==("undefined"===typeof console?"undefined":a(console))){var n=new Date,o=("0"+n.getMinutes()).substr(-2)+":"+("0"+n.getSeconds()).substr(-2)+"."+("00"+n.getMilliseconds()).substr(-3),s=this&&this.envIn&&this.envCheck&&this.id,c=["["+o+" "+u+(s?":"+s:"")+"]"+e],f=arguments,l=i.CLog,v=2,d=l.log||console.log;for(r(t)?d=1==t?l.error||console.error:3==t?l.warn||console.warn:d:v=1;v<f.length;v++)c.push(f[v]);O?d&&d("[IsLoser]"+c[0],1<c.length?c:""):d.apply(console,c)}};var A=function(){i.CLog.apply(this,arguments)},O=!0;try{O=!console.log.apply}catch(e){}var R=0;function U(e){var t=this;t.id=++R,P();var a={type:"mp3",onProcess:n};for(var o in e)a[o]=e[o];var i=(t.set=a)[d],s=a[v];(i&&!r(i)||s&&!r(s))&&t.CLog(W.G("IllegalArgs-1",[W("VtS4::{1}和{2}必须是数值",0,v,d)]),1,e),a[d]=+i||16,a[v]=+s||16e3,t.state=0,t._S=9,t.Sync={O:9,C:9}}i.Sync={O:9,C:9},i.prototype=U.prototype={CLog:A,_streamStore:function(){return this.set.sourceStream?this:i},_streamGet:function(){return this._streamStore().Stream},_streamCtx:function(){var e=this._streamGet();return e&&e._c},open:function(e,r){var u=this,l=u.set,d=u._streamStore(),h=0;e=e||n;var g=function(e,t){t=!!t,u.CLog(W("5tWi::录音open失败：")+e+",isUserNotAllow:"+t,1),h&&i.CloseNewCtx(h),r&&r(e,t)};u._streamTag=f;var m=function(){u.CLog("open ok, id:"+u.id+" stream:"+u._streamTag),e(),u._SO=0},b=d.Sync,_=++b.O,C=b.C;if(u._O=u._O_=_,u._SO=u._S,t){var y=u.envCheck({envName:"H5",canProcess:!0});if(y)g(W("A5bm::不能录音：")+y);else{var x,M=function(){(x=l.runningContext)||(x=h=i.GetContext(!0))};if(l.sourceStream){if(u._streamTag="set.sourceStream",!i.GetContext())return void g(W("1iU7::不支持此浏览器从流中获取录音"));M(),I(d);var k=u.Stream=l.sourceStream;k._c=x,k._RC=l.runningContext,k._call={};try{S(d)}catch(e){return I(d),void g(W("BTW2::从流中打开录音失败：")+e.message)}m()}else{var L=function(e,t){try{window.top.a}catch(e){return void g(W("Nclz::无权录音(跨域，请尝试给iframe添加麦克风访问策略，如{1})",0,'allow="camera;microphone"'))}T(1,e)&&(/Found/i.test(e)?g(t+W("jBa9::，无可用麦克风")):g(t))},T=function(e,t){if(/Permission|Allow/i.test(t))e&&g(W("gyO5::用户拒绝了录音权限"),!0);else{if(!1!==window.isSecureContext)return 1;e&&g(W("oWNo::浏览器禁止不安全页面录音，可开启https解决"))}};if(i.IsOpen())m();else if(i.Support()){M();var A,O,R=function(e){setTimeout((function(){e._call={};var t=i.Stream;t&&(I(),e._call=t._call),(i.Stream=e)._c=x,e._RC=l.runningContext,function(){if(C!=b.C||!u._O){var e=W("dFm8::open被取消");return _==b.O?u.close():e=W("VtJO::open被中断"),g(e),!0}}()||(i.IsOpen()?(t&&u.CLog(W("upb8::发现同时多次调用open"),1),S(d),m()):g(W("Q1GA::录音功能无效：无音频流")))}),100)},U=function(e){var t=e.name||e.message||e.code+":"+e,n="";1==N&&T(0,t)&&(n=W("KxE2::，将尝试禁用回声消除后重试"));var r=W("xEQR::请求录音权限错误"),a=W("bDOG::无法录音：");u.CLog(r+n+"|"+e,n||O?3:1,e),n?(A=t,O=e,z(1)):O?(u.CLog(r+"|"+O,1,O),L(A,a+O)):L(t,a+e)},N=0,z=function(e){N++;var t="audioTrackSet",n=JSON.parse(o(l[t]||!0));u.CLog("open... "+N+" "+t+":"+o(n)),e&&("object"!=a(n)&&(n={}),n["autoGainControl"]=!1,n["echoCancellation"]=!1,n["noiseSuppression"]=!1),n[v]&&u.CLog(W("IjL3::注意：已配置{1}参数，可能会出现浏览器不能正确选用麦克风、移动端无法启用回声消除等现象",0,t+"."+v),3);var r={audio:n,video:l.videoTrackSet||!1};try{var d=i.Scope[f](r,R,U)}catch(e){u.CLog(f,3,e),r={audio:!0,video:!1},d=i.Scope[f](r,R,U)}u.CLog(f+"("+o(r)+") "+w(x)+W("RiWe::，未配置 {1} 时浏览器可能会自动启用回声消除，移动端未禁用回声消除时可能会降低系统播放音量（关闭录音后可恢复）和仅提供16k采样率的音频流（不需要回声消除时可明确配置成禁用来获得48k高音质的流），请参阅文档中{2}配置",0,"audioTrackSet:{echoCancellation,noiseSuppression,autoGainControl}",t)+"("+c+") LM:"+s+" UA:"+navigator.userAgent),d&&d.then&&d.then(R)[p](U)};z()}else L("",W("COxc::此浏览器不支持录音"))}}}else g(W.G("NonBrowser-1",["open"])+W("EMJq::，可尝试使用RecordApp解决方案")+"("+c+"/tree/master/app-support-sample)")},close:function(e){e=e||n;var t=this,r=t._streamStore();t._stop();var a=" stream:"+t._streamTag,o=r.Sync;if(t._O=0,t._O_!=o.O)return t.CLog(W("hWVz::close被忽略（因为同时open了多个rec，只有最后一个会真正close）")+a,3),void e();o.C++,I(r),t.CLog("close,"+a),e()},mock:function(e,t){var n=this;return n._stop(),n.isMock=1,n.mockEnvInfo=null,n.buffers=[e],n.recSize=e.length,n._setSrcSR(t),n._streamTag="mock",n},_setSrcSR:function(e){var t=this.set,n=t[v];e<n?t[v]=e:n=0,this[l]=e,this.CLog(l+": "+e+" set."+v+": "+t[v]+(n?" "+W("UHvm::忽略")+": "+n:""),n?3:0)},envCheck:function(e){var t,n=this.set,r="CPU_BE";if(t||i[r]||"function"!=typeof Int8Array||new Int8Array(new Int32Array([1]).buffer)[0]||(P(r),t=W("Essp::不支持{1}架构",0,r)),!t){var a=n.type,o=this[a+"_envCheck"];n.takeoffEncodeChunk&&(o?e.canProcess||(t=W("7uMV::{1}环境不支持实时处理",0,e.envName)):t=W("2XBl::{1}类型不支持设置takeoffEncodeChunk",0,a)+(this[a]?"":W("LG7e::(未加载编码器)"))),!t&&o&&(t=this[a+"_envCheck"](e,n))}return t||""},envStart:function(e,t){var n=this,r=n.set;if(n.isMock=e?1:0,n.mockEnvInfo=e,n.buffers=[],n.recSize=0,e&&(n._streamTag="env$"+e.envName),n.state=1,n.envInLast=0,n.envInFirst=0,n.envInFix=0,n.envInFixTs=[],n._setSrcSR(t),n.engineCtx=0,n[r.type+"_start"]){var a=n.engineCtx=n[r.type+"_start"](r);a&&(a.pcmDatas=[],a.pcmSize=0)}},envResume:function(){this.envInFixTs=[]},envIn:function(e,t){var n=this,r=n.set,a=n.engineCtx;if(1==n.state){var o=n[l],s=e.length,c=i.PowerLevel(t,s),u=n.buffers,f=u.length;u.push(e);var d=u,p=f,h=Date.now(),g=Math.round(s/o*1e3);n.envInLast=h,1==n.buffers.length&&(n.envInFirst=h-g);var m=n.envInFixTs;m.splice(0,0,{t:h,d:g});for(var b=h,_=0,w=0;w<m.length;w++){var C=m[w];if(3e3<h-C.t){m.length=w;break}b=C.t,_+=C.d}var y=m[1],S=h-b,x=S-_;if(S/3<x&&(y&&1e3<S||6<=m.length)){var M=h-y.t-g;if(g/5<M){var k=!r.disableEnvInFix;if(n.CLog("["+h+"]"+G.get(W(k?"4Kfd::补偿{1}ms":"bM5i::未补偿{1}ms",1),[M]),3),n.envInFix+=M,k){var I=new Int16Array(M*o/1e3);s+=I.length,u.push(I)}}}var L=n.recSize,T=s,A=L+T;if(n.recSize=A,a){var O=i.SampleData(u,o,r[v],a.chunkInfo);a.chunkInfo=O,L=a.pcmSize,T=O.data.length,A=L+T,a.pcmSize=A,u=a.pcmDatas,f=u.length,u.push(O.data),o=O[v]}var R=Math.round(A/o*1e3),U=u.length,N=d.length,z=function(){for(var e=D?0:-T,t=null==u[0],o=f;o<U;o++){var i=u[o];null==i?t=1:(e+=i.length,a&&i.length&&n[r.type+"_encode"](a,i))}if(t&&a){o=p;for(d[0]&&(o=0);o<N;o++)d[o]=null}t&&(e=D?T:0,u[0]=null),a?a.pcmSize+=e:n.recSize+=e},D=0,E="rec.set.onProcess";try{D=!0===(D=r.onProcess(u,c,R,o,f,z))}catch(e){console.error(E+W("gFUF::回调出错是不允许的，需保证不会抛异常"),e)}var F=Date.now()-h;if(10<F&&1e3<n.envInFirst-h&&n.CLog(E+W("2ghS::低性能，耗时{1}ms",0,F),3),D){var P=0;for(w=f;w<U;w++)null==u[w]?P=1:u[w]=new Int16Array(0);P?n.CLog(W("ufqH::未进入异步前不能清除buffers"),3):a?a.pcmSize-=T:n.recSize-=T}else z()}else n.state||n.CLog("envIn at state=0",3)},start:function(){var e=this,t=1;if(e.set.sourceStream?e.Stream||(t=0):i.IsOpen()||(t=0),t){var n=e._streamCtx();if(e.CLog(W("kLDN::start 开始录音，")+w(n)+" stream:"+e._streamTag),e._stop(),e.envStart(null,n[v]),e.state=3,e._SO&&e._SO+1!=e._S)e.CLog(W("Bp2y::start被中断"),3);else{e._SO=0;var r=function(){3==e.state&&(e.state=1,e.resume())},a="AudioContext resume: ",o=e._streamGet();o._call[e.id]=function(){e.CLog(a+n.state+"|stream ok"),r()},b(n,(function(t){return t&&e.CLog(a+"wait..."),3==e.state}),(function(t){t&&e.CLog(a+n.state),r()}),(function(t){e.CLog(a+n.state+W("upkE::，可能无法录音：")+t,1),r()}))}}else e.CLog(W("6WmN::start失败：未open"),1)},pause:function(){var e=this,t=e._streamGet();e.state&&(e.state=2,e.CLog("pause"),t&&delete t._call[e.id])},resume:function(){var e=this,t=e._streamGet(),n="resume(wait ctx)";if(3==e.state)e.CLog(n);else if(e.state){e.state=1,e.CLog("resume"),e.envResume(),t&&(t._call[e.id]=function(t,n){1==e.state&&e.envIn(t,n)},x(t));var r=e._streamCtx();r&&b(r,(function(t){return t&&e.CLog(n+"..."),1==e.state}),(function(a){a&&e.CLog(n+r.state),x(t)}),(function(t){e.CLog(n+r.state+"[err]"+t,1)}))}},_stop:function(e){var t=this,n=t.set;t.isMock||t._S++,t.state&&(t.pause(),t.state=0),!e&&t[n.type+"_stop"]&&(t[n.type+"_stop"](t.engineCtx),t.engineCtx=0)},stop:function(e,t,n){var r,a=this,o=a.set,f=a.envInLast-a.envInFirst,d=f&&a.buffers.length;a.CLog(W("Xq4s::stop 和start时差:")+(f?f+"ms "+W("3CQP::补偿:")+a.envInFix+"ms envIn:"+d+" fps:"+(d/f*1e3).toFixed(1):"-")+" stream:"+a._streamTag+" ("+c+") LM:"+s);var p=function(){a._stop(),n&&a.close()},h=function(e){a.CLog(W("u8JG::结束录音失败：")+e,1),t&&t(e),p()},g=function(t,n,s){var c="arraybuffer",f="dataType",l="DefaultDataType",v=a[f]||i[l]||"blob",d=f+"="+v,g=t instanceof ArrayBuffer,m=0,b=g?t.byteLength:t.size;if(v==c?g||(m=1):"blob"==v?"function"!=typeof Blob?m=W.G("NonBrowser-1",[d])+W("1skY::，请设置{1}",0,u+"."+l+'="'+c+'"'):(g&&(t=new Blob([t],{type:n})),t instanceof Blob||(m=1),n=t.type||n):m=W.G("NotSupport-1",[d]),a.CLog(W("Wv7l::结束录音 编码花{1}ms 音频时长{2}ms 文件大小{3}b",0,Date.now()-r,s,b)+" "+d+","+n),m)h(1!=m?m:W("Vkbd::{1}编码器返回的不是{2}",0,o.type,v)+", "+d);else{if(o.takeoffEncodeChunk)a.CLog(W("QWnr::启用takeoffEncodeChunk后stop返回的blob长度为0不提供音频数据"),3);else if(b<Math.max(50,s/5))return void h(W("Sz2H::生成的{1}无效",0,o.type));e&&e(t,s,n),p()}};if(!a.isMock){var m=3==a.state;if(!a.state||m)return void h(W("wf9t::未开始录音")+(m?W("Dl2c::，开始录音前无用户交互导致AudioContext未运行"):""))}a._stop(!0);var b=a.recSize;if(b)if(a[o.type]){if(a.isMock){var _=a.envCheck(a.mockEnvInfo||{envName:"mock",canProcess:!1});if(_)return void h(W("AxOH::录音错误：")+_)}var w=a.engineCtx;if(a[o.type+"_complete"]&&w){var C=Math.round(w.pcmSize/o[v]*1e3);return r=Date.now(),void a[o.type+"_complete"](w,(function(e,t){g(e,t,C)}),h)}if(r=Date.now(),a.buffers[0]){var y=i.SampleData(a.buffers,a[l],o[v]);o[v]=y[v];var S=y.data;C=Math.round(S.length/o[v]*1e3);a.CLog(W("CxeT::采样:{1} 花:{2}ms",0,b+"->"+S.length,Date.now()-r)),setTimeout((function(){r=Date.now(),a[o.type](S,(function(e,t){g(e,t,C)}),(function(e){h(e)}))}))}else h(W("xkKd::音频buffers被释放"))}else h(W("xGuI::未加载{1}编码器，请尝试到{2}的src/engine内找到{1}的编码器并加载",0,o.type,u));else h(W("Ltz3::未采集到录音"))}};var N=function(e,t){t.pos||(t.pos=[0],t.tracks={},t.bytes=[]);var n=t.tracks,r=[t.pos[0]],a=function(){t.pos[0]=r[0]},o=t.bytes.length,i=new Uint8Array(o+e.length);if(i.set(t.bytes),i.set(e,o),t.bytes=i,!t._ht){if(E(i,r),F(i,r),!z(E(i,r),[24,83,128,103]))return;for(E(i,r);r[0]<i.length;){var s=E(i,r),c=F(i,r),u=[0],f=0;if(!c)return;if(z(s,[22,84,174,107])){for(;u[0]<c.length;){var l=E(c,u),d=F(c,u),p=[0],h={channels:0,sampleRate:0};if(z(l,[174]))for(;p[0]<d.length;){var g=E(d,p),m=F(d,p),b=[0];if(z(g,[215])){var _=D(m);h.number=_,n[_]=h}else if(z(g,[131])){_=D(m);1==_?h.type="video":2==_?(h.type="audio",f||(t.track0=h),h.idx=f++):h.type="Type-"+_}else if(z(g,[134])){for(var w="",C=0;C<m.length;C++)w+=String.fromCharCode(m[C]);h.codec=w}else if(z(g,[225]))for(;b[0]<m.length;){var y=E(m,b),S=F(m,b);if(z(y,[181])){_=0;var x=new Uint8Array(S.reverse()).buffer;4==S.length?_=new Float32Array(x)[0]:8==S.length?_=new Float64Array(x)[0]:A("WebM Track !Float",1,S),h[v]=Math.round(_)}else z(y,[98,100])?h.bitDepth=D(S):z(y,[159])&&(h.channels=D(S))}}}t._ht=1,A("WebM Tracks",n),a();break}}}var M=t.track0;if(M){var k=M[v];if(t.webmSR=k,16==M.bitDepth&&/FLOAT/i.test(M.codec)&&(M.bitDepth=32,A("WebM 16->32 bit",3)),k<8e3||32!=M.bitDepth||M.channels<1||!/(\b|_)PCM\b/i.test(M.codec))return t.bytes=[],t.bad||A("WebM Track Unexpected",3,t),-(t.bad=1);for(var I=[],L=0;r[0]<i.length;){l=E(i,r),d=F(i,r);if(!d)break;if(z(l,[163])){var T=15&d[0];h=n[T];if(!h)return A("WebM !Track"+T,1,n),-1;if(0===h.idx){var O=new Uint8Array(d.length-4);for(C=4;C<d.length;C++)O[C-4]=d[C];I.push(O),L+=O.length}}a()}if(L){var R=new Uint8Array(i.length-t.pos[0]);R.set(i.subarray(t.pos[0])),t.bytes=R,t.pos[0]=0;O=new Uint8Array(L),C=0;for(var U=0;C<I.length;C++)O.set(I[C],U),U+=I[C].length;x=new Float32Array(O.buffer);if(1<M.channels){var N=[];for(C=0;C<x.length;)N.push(x[C]),C+=M.channels;x=new Float32Array(N)}return x}}},z=function(e,t){if(!e||e.length!=t.length)return!1;if(1==e.length)return e[0]==t[0];for(var n=0;n<e.length;n++)if(e[n]!=t[n])return!1;return!0},D=function(e){for(var t="",n=0;n<e.length;n++){var r=e[n];t+=(r<16?"0":"")+r.toString(16)}return parseInt(t,16)||0},E=function(e,t,n){var r=t[0];if(!(r>=e.length)){var a=e[r],o=("0000000"+a.toString(2)).substr(-8),i=/^(0*1)(\d*)$/.exec(o);if(i){var s=i[1].length,c=[];if(!(r+s>e.length)){for(var u=0;u<s;u++)c[u]=e[r],r++;return n&&(c[0]=parseInt(i[2]||"0",2)),t[0]=r,c}}}},F=function(e,t){var n=E(e,t,1);if(n){var r=D(n),a=t[0],o=[];if(r<2147483647){if(a+r>e.length)return;for(var i=0;i<r;i++)o[i]=e[a],a++}return t[0]=a,o}},G=i.i18n={lang:"zh-CN",alias:{"zh-CN":"zh","en-US":"en"},locales:{},data:{},put:function(e,t){var n=u+".i18n.put: ",r=e.overwrite;r=null==r||r;var a=e.lang;if(!(a=G.alias[a]||a))throw new Error(n+"set.lang?");var o=G.locales[a];o||(o={},G.locales[a]=o);for(var i,s=/^([\w\-]+):/,c=0;c<t.length;c++){var f=t[c];if(i=s.exec(f)){var l=i[1];f=f.substr(l.length+1);!r&&o[l]||(o[l]=f)}else A(n+"'key:'? "+f,3,e)}},get:function(){return G.v_G.apply(null,arguments)},v_G:function(e,t,n){t=t||[],n=n||G.lang,n=G.alias[n]||n;var r=G.locales[n],a=r&&r[e]||"";return a||"zh"==n?(G.lastLang=n,"=Empty"==a?"":a.replace(/\{(\d+)(\!?)\}/g,(function(n,r,o){return n=t[(r=+r||0)-1],(r<1||r>t.length)&&(n="{?}",A("i18n["+e+"] no {"+r+"}: "+a,3)),o?"":n}))):"en"==n?G.v_G(e,t,"zh"):G.v_G(e,t,"en")},$T:function(){return G.v_T.apply(null,arguments)},v_T:function(){for(var e,t=arguments,n="",a=[],o=0,i=u+".i18n.$T:",s=/^([\w\-]*):/,c=0;c<t.length;c++){var f=t[c];if(0==c){if(e=s.exec(f),!(n=e&&e[1]))throw new Error(i+"0 'key:'?");f=f.substr(n.length+1)}if(-1===o)a.push(f);else{if(o)throw new Error(i+" bad args");if(0===f)o=-1;else if(r(f)){if(f<1)throw new Error(i+" bad args");o=f}else{var l=1==c?"en":c?"":"zh";if((e=s.exec(f))&&(l=e[1]||l,f=f.substr(e[1].length+1)),!e||!l)throw new Error(i+c+" 'lang:'?");G.put({lang:l,overwrite:!1},[n+":"+f])}}}return n?0<o?n:G.v_G(n,a):""}},W=G.$T;W.G=G.get,W("NonBrowser-1::非浏览器环境，不支持{1}",1),W("IllegalArgs-1::参数错误：{1}",1),W("NeedImport-2::调用{1}需要先导入{2}",2),W("NotSupport-1::不支持：{1}",1),i.TrafficImgUrl="//ia.51.la/go1?id=20469973&pvFlag=1";var P=i.Traffic=function(e){if(t){e=e?"/"+u+"/Report/"+e:"";var n=i.TrafficImgUrl;if(n){var r=i.Traffic,a=/^(https?:..[^\/#]*\/?)[^#]*/i.exec(location.href)||[],o=a[1]||"http://file/",s=(a[0]||o)+e;if(0==n.indexOf("//")&&(n=/^https:/i.test(s)?"https:"+n:"http:"+n),e&&(n=n+"&cu="+encodeURIComponent(o+e)),!r[s]){r[s]=1;var c=new Image;c.src=n,A("Traffic Analysis Image: "+(e||u+".TrafficImgUrl="+i.TrafficImgUrl))}}}};h&&(A(W("8HO5::覆盖导入{1}",0,u),1),h.Destroy()),e[u]=i}(s,i),r=function(){return s.Recorder}.call(t,n,t,e),void 0!==r&&(e.exports=r),"object"==a(e)&&e.exports&&(e.exports=s.Recorder)}(),function(e){var t="object"==("undefined"===typeof window?"undefined":a(window))&&!!window.document,n=(t?window:Object).Recorder,r=n.i18n;!function(e,t,n,r){"use strict";e.prototype.enc_wav={stable:!0,fast:!0,getTestMsg:function(){return n("gPSE::支持位数8位、16位（填在比特率里面），采样率取值无限制；此编码器仅在pcm数据前加了一个44字节的wav头，编码出来的16位wav文件去掉开头的44字节即可得到pcm（注：其他wav编码器可能不是44字节）")}},e.prototype.wav=function(t,r,a){var o=this.set;!function(t){var r=t.bitRate,a=8==r?8:16;r!=a&&e.CLog(n("wyw9::WAV Info: 不支持{1}位，已更新成{2}位",0,r,a),3),t.bitRate=a}(o);var i=t.length,s=o.sampleRate,c=o.bitRate,u=i*(c/8),f=e.wav_header(1,1,s,c,u),l=f.length,v=new Uint8Array(l+u);if(v.set(f),8==c)for(var d=0;d<i;d++){var p=128+(t[d]>>8);v[l++]=p}else(v=new Int16Array(v.buffer)).set(t,l/2);r(v.buffer,"audio/wav")},e.wav_header=function(e,t,n,r,a){var o=1==e?0:2,i=new ArrayBuffer(44+o),s=new DataView(i),c=0,u=function(e){for(var t=0;t<e.length;t++,c++)s.setUint8(c,e.charCodeAt(t))},f=function(e){s.setUint16(c,e,!0),c+=2},l=function(e){s.setUint32(c,e,!0),c+=4};return u("RIFF"),l(36+o+a),u("WAVE"),u("fmt "),l(16+o),f(e),f(t),l(n),l(n*(t*r/8)),f(t*r/8),f(r),1!=e&&f(0),u("data"),l(a),new Uint8Array(i)}}(n,0,r.$T)}()}).call(this,n("dc84")(e))},"4f9b":function(e,t,n){"use strict";var r=n("6a50");r("Float32",(function(e){return function(t,n,r){return e(this,t,n,r)}}))},"5d97":function(e,t,n){"use strict";n("6a54"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,n("c9b5"),n("bf0f"),n("ab80"),n("c223"),n("20f3"),n("18f7"),n("de6c"),n("dc89"),n("2425"),n("4ec3");var r="Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJodHRwczovL2xpdmUudGVsbGFpLnRlY2giLCJzdWIiOiI3ODNjNGI1NC1hMWQwLTVmY2ItOTExZC1kNWM1YjNjODY2MTAiLCJpYXQiOjE3NDIyMTA0NDQsImV4cCI6MTc1OTc5NTIwMCwibmFtZSI6InRlc3QifQ.OGrW6VfdM7zLVcGjGz9UHblQQlQoHWSriFB90kJOq98",a={data:function(){return{recorder:null,audioUrl:""}},methods:{generateUniqueId:function(){return Date.now()+Math.random().toString(36).substr(2,16)},handlerUpload:function(){var e=this,t=this;uni.request({url:"https://live.tellai.tech/api/media/files/upload_request?type=audio",header:{Authorization:r},success:function(n){var a=n.data.base_resp,o=n.data.data;if(200===a.status_code){var i={name:"录制.wav",type:"voice",id:t.generateUniqueId()};t.$store.dispatch("task/addTask",i),t.$tip.confirm("已创建音色克隆任务\n《录制.wav》",!1).then((function(e){uni.redirectTo({url:"/pages/template/voice"})})),uni.uploadFile({url:o.upload_url,file:e.file,name:"file",header:{Authorization:r},timeout:18e5,formData:{file_id:o.file_id,type:"audio"},success:function(e){var n=JSON.parse(e.data).base_resp,r=JSON.parse(e.data).data;200===n.status_code?t.clone(r.file_id,i):(t.$store.dispatch("task/removeTask",i.id),t.$tip.confirm("".concat(i.name,"音色克隆任务失败,").concat(n.status_msg),!1))}})}else e.$tip.confirm(a.status_msg,!1)}})},clone:function(e,t){var n=this,r={file_id:e,user_id:uni.getStorageSync("userId"),audio_name:t.name.substring(0,t.name.lastIndexOf("."))};this.$http.post("/timbres/clone/file_id",r).then((function(e){n.$store.dispatch("task/removeTask",t.id),"success"===e.status?n.$tip.confirm("".concat(t.name,"音色克隆任务成功"),!1):n.$tip.confirm("".concat(t.name,"音色克隆任务失败,").concat(e.message),!1)}))},startRecording:function(){var e=this;window.Recorder?(this.recorder=window.Recorder({type:"wav",sampleRate:16e3,bitRate:16}),this.recorder.open((function(){e.recorder.start(),uni.showToast({title:"录音中...",icon:"none"})}),(function(e,t){console.error("录音授权失败:",e),uni.showToast({title:"录音失败",icon:"none"})}))):uni.showToast({title:"录音库未加载",icon:"none"})},stopRecording:function(){var e=this;this.recorder&&this.recorder.stop((function(t,n){e.audioUrl=URL.createObjectURL(t),e.file=new File([t],"recording.wav",{type:"audio/wav"}),console.log(e.file)}),(function(e){console.error("停止失败:",e),uni.showToast({title:"停止失败",icon:"none"})}))}}};t.default=a},6577:function(e,t,n){var r=n("c86c");t=r(!1),t.push([e.i,".container[data-v-386ef002]{padding:%?40?%}uni-button[data-v-386ef002]{display:block;margin:%?20?% auto;width:%?200?%;height:%?80?%;line-height:%?80?%;text-align:center;background-color:#007aff;color:#fff;border-radius:%?10?%}",""]),e.exports=t},"825c":function(e,t,n){"use strict";var r=n("6a50");r("Float64",(function(e){return function(t,n,r){return e(this,t,n,r)}}))},"8f89":function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){}));var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-uni-view",{staticClass:"container"},[n("v-uni-button",{on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.startRecording.apply(void 0,arguments)}}},[e._v("开始录音")]),n("v-uni-button",{on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.stopRecording.apply(void 0,arguments)}}},[e._v("停止")]),e.audioUrl?n("v-uni-audio",{attrs:{src:e.audioUrl,controls:!0}}):e._e(),n("v-uni-button",{on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.handlerUpload.apply(void 0,arguments)}}},[e._v("上传")])],1)},a=[]},c02e:function(e,t,n){"use strict";var r=n("6a50");r("Int32",(function(e){return function(t,n,r){return e(this,t,n,r)}}))},cd5f:function(e,t,n){"use strict";n.r(t);var r=n("8f89"),a=n("0e66");for(var o in a)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(o);n("f97b");var i=n("828b"),s=Object(i["a"])(a["default"],r["b"],r["c"],!1,null,"386ef002",null,!1,r["a"],void 0);t["default"]=s.exports},f97b:function(e,t,n){"use strict";var r=n("395d"),a=n.n(r);a.a}}]);