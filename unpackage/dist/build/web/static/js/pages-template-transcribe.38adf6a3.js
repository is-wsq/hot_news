(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-template-transcribe"],{"0d84":function(e,t,r){var a=r("b011");a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);var n=r("967d").default;n("2b43421f",a,!0,{sourceMap:!1,shadowMode:!1})},"20f3":function(e,t,r){"use strict";var a=r("8bdb"),n=r("5145");a({target:"Array",proto:!0,forced:n!==[].lastIndexOf},{lastIndexOf:n})},"3dbe":function(e,t,r){"use strict";r.d(t,"b",(function(){return n})),r.d(t,"c",(function(){return i})),r.d(t,"a",(function(){return a}));var a={uniIcons:r("00f9").default,mumuRecorder:r("a5ec").default},n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-uni-view",{staticClass:"pages transcribe"},[r("v-uni-view",{staticClass:"nav-bar-header"},[r("uni-icons",{staticClass:"nav-bar-back",attrs:{type:"left",size:"21",color:"#ffffff"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.back.apply(void 0,arguments)}}}),r("v-uni-view",{staticClass:"nav-bar-title"},[e._v("在线录制")])],1),r("v-uni-view",[e.recorder?r("v-uni-audio",{attrs:{src:e.recorder.localUrl,name:"本地录音",controls:"true"}}):e._e(),r("v-uni-view",{on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.handlerOnCahnger.apply(void 0,arguments)}}},[e._v(e._s(e.status?"结束录音":"开始录音"))]),r("mumu-recorder",{ref:"recorder",on:{success:function(t){arguments[0]=t=e.$handleEvent(t),e.handlerSuccess.apply(void 0,arguments)},error:function(t){arguments[0]=t=e.$handleEvent(t),e.handlerError.apply(void 0,arguments)}}})],1),r("v-uni-view",{staticStyle:{display:"flex",gap:"20px"}},[r("v-uni-button",{staticStyle:{flex:"1"},attrs:{type:"primary"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.handlerSave.apply(void 0,arguments)}}},[e._v("保存")]),r("v-uni-button",{staticStyle:{flex:"1"},attrs:{type:"primary"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.handlerUpload.apply(void 0,arguments)}}},[e._v("上传")])],1)],1)},i=[]},6498:function(e,t,r){"use strict";r("6a54"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,r("5ef2"),r("bf0f"),r("2797"),r("aa9c"),r("18f7"),r("de6c"),r("dc89"),r("2425"),r("c9b5"),r("ab80"),r("dd2b"),r("e838");var a={data:function(){return{isUserMedia:!1,stream:null,audio:null,recorder:null,chunks:[],startTime:0}},mounted:function(){if(-1===origin.indexOf("https"))throw this.$emit("error","100"),"请在 https 环境中使用本插件。";if(!navigator.mediaDevices||!window.MediaRecorder)throw this.$emit("error","101"),"当前浏览器不支持";this.getRecorderManager()},methods:{getRecorderManager:function(){var e=this;this.audio=document.createElement("audio"),navigator.mediaDevices.getUserMedia({audio:!0}).then((function(t){e.isUserMedia=!0,t.getTracks().forEach((function(e){e.stop()}))})).catch((function(t){e.onErrorHandler(t)}))},start:function(){var e=this;if(!this.isUserMedia)return console.log("设备不支持");navigator.mediaDevices.getUserMedia({audio:!0}).then((function(t){e.startTime=(new Date).getTime(),e.stream=t,e.recorder=new MediaRecorder(t),e.recorder.ondataavailable=e.getRecordingData,e.recorder.onstop=e.saveRecordingData,e.recorder.start()})).catch((function(t){e.onErrorHandler(t)}))},stop:function(){this.recorder.stop(),this.stream.getTracks().forEach((function(e){e.stop()}))},getRecordingData:function(e){this.chunks.push(e.data)},saveRecordingData:function(){var e=new Blob(this.chunks,{type:"audio/mpeg"}),t=URL.createObjectURL(e),r=(new Date).getTime(),a=(r-this.startTime).toString().split("");a.splice(a.length-2),a.splice(a.length-1,0,"."),a=parseFloat(a.join(""));var n={data:e,duration:a,localUrl:t};this.$emit("success",n)},onErrorHandler:function(e){if(console.log(e),"NotAllowedError"===e.name)throw this.$emit("error","201"),"用户拒绝了当前的浏览器实例的访问请求";if("NotReadableError"===e.name)throw this.$emit("error","101"),"当前浏览器不支持";throw this.$emit("error","500"),"调用失败，原因不详"}},destroyed:function(){this.stop()}};t.default=a},"6f3e":function(e,t,r){"use strict";r("6a54");var a=r("f5bd").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,r("c9b5"),r("bf0f"),r("ab80"),r("c223"),r("20f3"),r("d4b5");var n=a(r("a5ec")),i="Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJodHRwczovL2xpdmUudGVsbGFpLnRlY2giLCJzdWIiOiI3ODNjNGI1NC1hMWQwLTVmY2ItOTExZC1kNWM1YjNjODY2MTAiLCJpYXQiOjE3NDIyMTA0NDQsImV4cCI6MTc1OTc5NTIwMCwibmFtZSI6InRlc3QifQ.OGrW6VfdM7zLVcGjGz9UHblQQlQoHWSriFB90kJOq98",o={components:{MumuRecorder:n.default},data:function(){return{status:!1,recorder:null}},mounted:function(){},methods:{handlerSave:function(){var e=document.createElement("a");e.href=this.recorder.localUrl,e.download="录音",e.click()},generateUniqueId:function(){return Date.now()+Math.random().toString(36).substr(2,16)},handlerUpload:function(){var e=this,t=this;uni.request({url:"https://live.tellai.tech/api/media/files/upload_request?type=audio",header:{Authorization:i},success:function(r){var a=r.data.base_resp,n=r.data.data;if(200===a.status_code){var o={name:"录制.wav",type:"voice",id:t.generateUniqueId()};t.$store.dispatch("task/addTask",o),t.$tip.confirm("已创建音色克隆任务\n《录制.wav》",!1).then((function(e){uni.redirectTo({url:"/pages/template/voice"})})),console.log("文件",t.recorder);var c=new File([t.recorder.data],"recording.wav",{type:"audio/wav"});console.log("文件1",c),uni.uploadFile({url:"https://u480621-ba45-4d5fd016.westc.gpuhub.com:8443/files/upload_file",file:c,name:"file",header:{Authorization:i},timeout:18e5,formData:{file_id:n.file_id,type:"audio"},success:function(e){var r=JSON.parse(e.data).base_resp,a=JSON.parse(e.data).data;200===r.status_code?t.clone(a.file_id,o):(t.$store.dispatch("task/removeTask",o.id),t.$tip.confirm("".concat(o.name,"音色克隆任务失败,").concat(r.status_msg),!1))}})}else e.$tip.confirm(a.status_msg,!1)}})},clone:function(e,t){var r=this,a={file_id:e,user_id:uni.getStorageSync("userId"),audio_name:t.name.substring(0,t.name.lastIndexOf("."))};this.$http.post("/timbres/clone/file_id",a).then((function(e){r.$store.dispatch("task/removeTask",t.id),"success"===e.status?r.$tip.confirm("".concat(t.name,"音色克隆任务成功"),!1):r.$tip.confirm("".concat(t.name,"音色克隆任务失败,").concat(e.message),!1)}))},handlerOnCahnger:function(){this.status?this.$refs.recorder.stop():this.$refs.recorder.start(),this.status=!this.status},handlerSuccess:function(e){this.$tip.confirm(JSON.stringify(e),!1),this.recorder=e},handlerError:function(e){switch(e){case"101":uni.showModal({content:"当前浏览器版本较低，请更换浏览器使用，推荐在微信中打开。"});break;case"201":uni.showModal({content:"麦克风权限被拒绝，请刷新页面后授权麦克风权限。"});break;default:uni.showModal({content:"未知错误，请刷新页面重试"});break}},back:function(){uni.redirectTo({url:"/pages/template/voicesClone"})}}};t.default=o},"742d":function(e,t,r){"use strict";r.r(t);var a=r("3dbe"),n=r("fbee");for(var i in n)["default"].indexOf(i)<0&&function(e){r.d(t,e,(function(){return n[e]}))}(i);r("96c5");var o=r("828b"),c=Object(o["a"])(n["default"],a["b"],a["c"],!1,null,"65c17348",null,!1,a["a"],void 0);t["default"]=c.exports},"96c5":function(e,t,r){"use strict";var a=r("0d84"),n=r.n(a);n.a},a5ec:function(e,t,r){"use strict";r.r(t);var a=r("d61f"),n=r("ebdc");for(var i in n)["default"].indexOf(i)<0&&function(e){r.d(t,e,(function(){return n[e]}))}(i);var o=r("828b"),c=Object(o["a"])(n["default"],a["b"],a["c"],!1,null,"81f4c7bc",null,!1,a["a"],void 0);t["default"]=c.exports},b011:function(e,t,r){var a=r("c86c");t=a(!1),t.push([e.i,".transcribe[data-v-65c17348]{height:100vh;color:#fff}",""]),e.exports=t},d61f:function(e,t,r){"use strict";r.d(t,"b",(function(){return a})),r.d(t,"c",(function(){return n})),r.d(t,"a",(function(){}));var a=function(){var e=this.$createElement,t=this._self._c||e;return t("v-uni-view",{staticClass:"recorder"})},n=[]},ebdc:function(e,t,r){"use strict";r.r(t);var a=r("6498"),n=r.n(a);for(var i in a)["default"].indexOf(i)<0&&function(e){r.d(t,e,(function(){return a[e]}))}(i);t["default"]=n.a},fbee:function(e,t,r){"use strict";r.r(t);var a=r("6f3e"),n=r.n(a);for(var i in a)["default"].indexOf(i)<0&&function(e){r.d(t,e,(function(){return a[e]}))}(i);t["default"]=n.a}}]);