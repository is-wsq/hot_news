(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-template-transcribe"],{"20f3":function(e,t,a){"use strict";var r=a("8bdb"),n=a("5145");r({target:"Array",proto:!0,forced:n!==[].lastIndexOf},{lastIndexOf:n})},6498:function(e,t,a){"use strict";a("6a54"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("5ef2"),a("bf0f"),a("2797"),a("aa9c"),a("18f7"),a("de6c"),a("dc89"),a("2425"),a("c9b5"),a("ab80"),a("dd2b"),a("e838");var r={data:function(){return{isUserMedia:!1,stream:null,audio:null,recorder:null,chunks:[],startTime:0}},mounted:function(){if(-1===origin.indexOf("https"))throw this.$emit("error","100"),"请在 https 环境中使用本插件。";if(!navigator.mediaDevices||!window.MediaRecorder)throw this.$emit("error","101"),"当前浏览器不支持";this.getRecorderManager()},methods:{getRecorderManager:function(){var e=this;this.audio=document.createElement("audio"),navigator.mediaDevices.getUserMedia({audio:!0}).then((function(t){e.isUserMedia=!0,t.getTracks().forEach((function(e){e.stop()}))})).catch((function(t){e.onErrorHandler(t)}))},start:function(){var e=this;if(!this.isUserMedia)return console.log("设备不支持");navigator.mediaDevices.getUserMedia({audio:!0}).then((function(t){e.startTime=(new Date).getTime(),e.stream=t,e.recorder=new MediaRecorder(t),e.recorder.ondataavailable=e.getRecordingData,e.recorder.onstop=e.saveRecordingData,e.recorder.start()})).catch((function(t){e.onErrorHandler(t)}))},stop:function(){this.recorder.stop(),this.stream.getTracks().forEach((function(e){e.stop()}))},getRecordingData:function(e){this.chunks.push(e.data)},saveRecordingData:function(){var e=new Blob(this.chunks,{type:"audio/mp3"}),t=URL.createObjectURL(e),a=(new Date).getTime(),r=(a-this.startTime).toString().split("");r.splice(r.length-2),r.splice(r.length-1,0,"."),r=parseFloat(r.join(""));var n={data:e,duration:r,localUrl:t};this.$emit("success",n)},onErrorHandler:function(e){if(console.log(e),"NotAllowedError"===e.name)throw this.$emit("error","201"),"用户拒绝了当前的浏览器实例的访问请求";if("NotReadableError"===e.name)throw this.$emit("error","101"),"当前浏览器不支持";throw this.$emit("error","500"),"调用失败，原因不详"}},destroyed:function(){this.stop()}};t.default=r},"6f3e":function(e,t,a){"use strict";a("6a54");var r=a("f5bd").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("c9b5"),a("bf0f"),a("ab80"),a("c223"),a("20f3"),a("d4b5");var n=r(a("a5ec")),i="Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJodHRwczovL2xpdmUudGVsbGFpLnRlY2giLCJzdWIiOiI3ODNjNGI1NC1hMWQwLTVmY2ItOTExZC1kNWM1YjNjODY2MTAiLCJpYXQiOjE3NDIyMTA0NDQsImV4cCI6MTc1OTc5NTIwMCwibmFtZSI6InRlc3QifQ.OGrW6VfdM7zLVcGjGz9UHblQQlQoHWSriFB90kJOq98",o={components:{MumuRecorder:n.default},data:function(){return{status:!1,recorder:null}},mounted:function(){},methods:{handlerSave:function(){var e=document.createElement("a");e.href=this.recorder.localUrl,e.download="录音",e.click()},generateUniqueId:function(){return Date.now()+Math.random().toString(36).substr(2,16)},handlerUpload:function(){var e=this,t=this;uni.request({url:"https://live.tellai.tech/api/media/files/upload_request?type=audio",header:{Authorization:i},success:function(a){var r=a.data.base_resp,n=a.data.data;if(200===r.status_code){var o={name:"录制.wav",type:"voice",id:t.generateUniqueId()};t.$store.dispatch("task/addTask",o),t.$tip.confirm("已创建音色克隆任务\n《录制.wav》",!1).then((function(e){uni.redirectTo({url:"/pages/template/voice"})})),console.log("文件",t.recorder);var c=new File([t.recorder.data],"recording.wav",{type:"audio/mp3"});console.log("文件1",c),uni.uploadFile({url:"https://u480621-ba45-4d5fd016.westc.gpuhub.com:8443/files/upload_file",file:c,name:"file",header:{Authorization:i},timeout:18e5,formData:{file_id:n.file_id,type:"audio"},success:function(e){var a=JSON.parse(e.data).base_resp,r=JSON.parse(e.data).data;200===a.status_code?t.clone(r.file_id,o):(t.$store.dispatch("task/removeTask",o.id),t.$tip.confirm("".concat(o.name,"音色克隆任务失败,").concat(a.status_msg),!1))}})}else e.$tip.confirm(r.status_msg,!1)}})},clone:function(e,t){var a=this,r={file_id:e,user_id:uni.getStorageSync("userId"),audio_name:t.name.substring(0,t.name.lastIndexOf("."))};this.$http.post("/timbres/clone/file_id",r).then((function(e){a.$store.dispatch("task/removeTask",t.id),"success"===e.status?a.$tip.confirm("".concat(t.name,"音色克隆任务成功"),!1):a.$tip.confirm("".concat(t.name,"音色克隆任务失败,").concat(e.message),!1)}))},handlerOnCahnger:function(){this.status?this.$refs.recorder.stop():this.$refs.recorder.start(),this.status=!this.status},handlerSuccess:function(e){this.$tip.confirm(JSON.stringify(e),!1),this.recorder=e},handlerError:function(e){switch(e){case"101":uni.showModal({content:"当前浏览器版本较低，请更换浏览器使用，推荐在微信中打开。"});break;case"201":uni.showModal({content:"麦克风权限被拒绝，请刷新页面后授权麦克风权限。"});break;default:uni.showModal({content:"未知错误，请刷新页面重试"});break}},back:function(){uni.redirectTo({url:"/pages/template/voicesClone"})}}};t.default=o},7062:function(e,t,a){var r=a("e380");r.__esModule&&(r=r.default),"string"===typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);var n=a("967d").default;n("116f5503",r,!0,{sourceMap:!1,shadowMode:!1})},"742d":function(e,t,a){"use strict";a.r(t);var r=a("ecb5"),n=a("fbee");for(var i in n)["default"].indexOf(i)<0&&function(e){a.d(t,e,(function(){return n[e]}))}(i);a("8dc6");var o=a("828b"),c=Object(o["a"])(n["default"],r["b"],r["c"],!1,null,"2ea2ae78",null,!1,r["a"],void 0);t["default"]=c.exports},"8dc6":function(e,t,a){"use strict";var r=a("7062"),n=a.n(r);n.a},a5ec:function(e,t,a){"use strict";a.r(t);var r=a("a75f"),n=a("ebdc");for(var i in n)["default"].indexOf(i)<0&&function(e){a.d(t,e,(function(){return n[e]}))}(i);var o=a("828b"),c=Object(o["a"])(n["default"],r["b"],r["c"],!1,null,"135a4e07",null,!1,r["a"],void 0);t["default"]=c.exports},a75f:function(e,t,a){"use strict";a.d(t,"b",(function(){return r})),a.d(t,"c",(function(){return n})),a.d(t,"a",(function(){}));var r=function(){var e=this.$createElement,t=this._self._c||e;return t("v-uni-view",{staticClass:"recorder"})},n=[]},e380:function(e,t,a){var r=a("c86c");t=r(!1),t.push([e.i,".transcribe[data-v-2ea2ae78]{height:100vh;color:#fff}",""]),e.exports=t},ebdc:function(e,t,a){"use strict";a.r(t);var r=a("6498"),n=a.n(r);for(var i in r)["default"].indexOf(i)<0&&function(e){a.d(t,e,(function(){return r[e]}))}(i);t["default"]=n.a},ecb5:function(e,t,a){"use strict";a.d(t,"b",(function(){return n})),a.d(t,"c",(function(){return i})),a.d(t,"a",(function(){return r}));var r={uniIcons:a("00f9").default,mumuRecorder:a("a5ec").default},n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-uni-view",{staticClass:"pages transcribe"},[a("v-uni-view",{staticClass:"nav-bar-header"},[a("uni-icons",{staticClass:"nav-bar-back",attrs:{type:"left",size:"21",color:"#ffffff"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.back.apply(void 0,arguments)}}}),a("v-uni-view",{staticClass:"nav-bar-title"},[e._v("在线录制")])],1),a("v-uni-view",[e.recorder?a("v-uni-audio",{attrs:{src:e.recorder.localUrl,name:"本地录音",controls:"true"}}):e._e(),a("v-uni-view",{on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.handlerOnCahnger.apply(void 0,arguments)}}},[e._v(e._s(e.status?"结束录音":"开始录音"))]),a("mumu-recorder",{ref:"recorder",on:{success:function(t){arguments[0]=t=e.$handleEvent(t),e.handlerSuccess.apply(void 0,arguments)},error:function(t){arguments[0]=t=e.$handleEvent(t),e.handlerError.apply(void 0,arguments)}}})],1),a("v-uni-view",{staticStyle:{display:"flex",gap:"20px"}},[a("v-uni-button",{staticStyle:{flex:"1"},attrs:{type:"primary"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.handlerSave.apply(void 0,arguments)}}},[e._v("保存")]),a("v-uni-button",{staticStyle:{flex:"1"},attrs:{type:"primary"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.handlerUpload.apply(void 0,arguments)}}},[e._v("上传")])],1)],1)},i=[]},fbee:function(e,t,a){"use strict";a.r(t);var r=a("6f3e"),n=a.n(r);for(var i in r)["default"].indexOf(i)<0&&function(e){a.d(t,e,(function(){return r[e]}))}(i);t["default"]=n.a}}]);