(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-template-recorder"],{"0e66":function(e,t,i){"use strict";i.r(t);var a=i("5d97"),o=i.n(a);for(var r in a)["default"].indexOf(r)<0&&function(e){i.d(t,e,(function(){return a[e]}))}(r);t["default"]=o.a},"20f3":function(e,t,i){"use strict";var a=i("8bdb"),o=i("5145");a({target:"Array",proto:!0,forced:o!==[].lastIndexOf},{lastIndexOf:o})},"5d97":function(e,t,i){"use strict";i("6a54"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,i("c9b5"),i("bf0f"),i("ab80"),i("c223"),i("20f3"),i("18f7"),i("de6c"),i("dc89"),i("2425"),i("4ec3");var a="Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJodHRwczovL2xpdmUudGVsbGFpLnRlY2g6NTAxMSIsInN1YiI6Ijg1YmIzNDgyLWNmYTgtNWJiNC1iZGRiLWIzYzg5ZTYwYTkwMyIsImlhdCI6MTc1MDA1OTU4NywiZXhwIjoxNzgxNTY4MDAwLCJuYW1lIjoidGlhbiJ9.yGOBshwKI2LoRh03ZmqYYfCvP_X7KfrlAAuoc_TId7M",o={data:function(){return{recorder:null,audioUrl:""}},beforeDestroy:function(){this.recorder&&this.recorder.close()},methods:{generateUniqueId:function(){return Date.now()+Math.random().toString(36).substr(2,16)},handlerUpload:function(){var e=this,t=this;uni.request({url:"https://live.tellai.tech/api/media/files/upload_request?type=audio",header:{Authorization:a},success:function(i){var o=i.data.base_resp,r=i.data.data;if(200===o.status_code){var n={name:"录制.wav",type:"voice",id:t.generateUniqueId()};t.$store.dispatch("task/addTask",n),t.$tip.confirm("已创建音色克隆任务\n《录制.wav》",!1).then((function(e){uni.redirectTo({url:"/pages/template/voice"})})),uni.uploadFile({url:r.upload_url,file:e.file,name:"file",header:{Authorization:a},timeout:18e5,formData:{file_id:r.file_id,type:"audio"},success:function(e){var i=JSON.parse(e.data).base_resp,a=JSON.parse(e.data).data;200===i.status_code?t.clone(a.file_id,n):(t.$store.dispatch("task/removeTask",n.id),t.$tip.confirm("".concat(n.name,"音色克隆任务失败,").concat(i.status_msg),!1))}})}else e.$tip.confirm(o.status_msg,!1)}})},clone:function(e,t){var i=this,a={file_id:e,user_id:uni.getStorageSync("userId"),audio_name:t.name.substring(0,t.name.lastIndexOf("."))};this.$http.post("/timbres/clone/file_id",a).then((function(e){i.$store.dispatch("task/removeTask",t.id),"success"===e.status?i.$tip.confirm("".concat(t.name,"音色克隆任务成功"),!1):i.$tip.confirm("".concat(t.name,"音色克隆任务失败,").concat(e.message),!1)}))},startRecording:function(){var e=this;window.Recorder?(this.recorder=window.Recorder({type:"wav",sampleRate:16e3,bitRate:16}),this.recorder.open((function(){e.recorder.start(),uni.showToast({title:"录音中...",icon:"none"})}),(function(e,t){console.error("录音授权失败:",e),uni.showToast({title:"录音失败",icon:"none"})}))):uni.showToast({title:"录音库未加载",icon:"none"})},stopRecording:function(){var e=this;this.recorder&&this.recorder.stop((function(t,i){e.audioUrl=URL.createObjectURL(t),e.recorder.close(),e.file=new File([t],"recording.wav",{type:"audio/wav"}),console.log(e.file)}),(function(e){console.error("停止失败:",e),uni.showToast({title:"停止失败",icon:"none"})}))},back:function(){uni.redirectTo({url:"/pages/template/voicesClone"})}}};t.default=o},"924c":function(e,t,i){"use strict";i.d(t,"b",(function(){return o})),i.d(t,"c",(function(){return r})),i.d(t,"a",(function(){return a}));var a={uniIcons:i("00f9").default},o=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-uni-view",{staticClass:"pages recorder"},[i("v-uni-view",{staticClass:"nav-bar-header"},[i("uni-icons",{staticClass:"nav-bar-back",attrs:{type:"left",size:"21",color:"#ffffff"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.back.apply(void 0,arguments)}}}),i("v-uni-view",{staticClass:"nav-bar-title"},[e._v("在线录制")])],1),i("v-uni-view",{staticClass:"autocue"}),i("v-uni-view",{staticClass:"recorder-audio"},[i("v-uni-audio",{attrs:{src:e.audioUrl,controls:!0}})],1),i("v-uni-view",{staticClass:"recorder-box"},[i("v-uni-canvas",{ref:"canvas",attrs:{width:"100%",height:"100%"}}),i("v-uni-view",{staticClass:"recorder-btn"},[e.recorder?i("uni-icons",{attrs:{type:"micoff-filled",size:"30",color:"#ffffff"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.stopRecording.apply(void 0,arguments)}}}):i("uni-icons",{staticStyle:{border:"1px solid #ffffff"},attrs:{type:"mic-filled",size:"30",color:"#ffffff"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.startRecording.apply(void 0,arguments)}}})],1)],1)],1)},r=[]},"9fdc":function(e,t,i){var a=i("c428");a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);var o=i("967d").default;o("665a7b15",a,!0,{sourceMap:!1,shadowMode:!1})},c428:function(e,t,i){var a=i("c86c");t=a(!1),t.push([e.i,".recorder[data-v-7f401e7a]{height:100vh}.autocue[data-v-7f401e7a]{height:200px;border-radius:10px;background-color:#f5f5f5}.recorder-audio[data-v-7f401e7a]{height:200px;display:flex;justify-content:center;align-items:center;border:1px solid red}.recorder-box[data-v-7f401e7a]{height:calc(100vh - 465px);border:1px solid red;position:relative}.recorder-btn[data-v-7f401e7a]{position:absolute;bottom:0;height:100px;width:100%;border:1px solid #ff0;display:flex;justify-content:center;align-items:center}",""]),e.exports=t},cd5f:function(e,t,i){"use strict";i.r(t);var a=i("924c"),o=i("0e66");for(var r in o)["default"].indexOf(r)<0&&function(e){i.d(t,e,(function(){return o[e]}))}(r);i("f12c");var n=i("828b"),c=Object(n["a"])(o["default"],a["b"],a["c"],!1,null,"7f401e7a",null,!1,a["a"],void 0);t["default"]=c.exports},f12c:function(e,t,i){"use strict";var a=i("9fdc"),o=i.n(a);o.a}}]);