(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-user-integral"],{"19c3":function(e,t,a){"use strict";a.d(t,"b",(function(){return n})),a.d(t,"c",(function(){return c})),a.d(t,"a",(function(){return i}));var i={uniIcons:a("00f9").default},n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-uni-view",{staticClass:"pages integral"},[a("v-uni-view",{staticClass:"nav-bar-header"},[a("uni-icons",{staticClass:"nav-bar-back",attrs:{type:"left",size:"21",color:"#ffffff"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.back.apply(void 0,arguments)}}}),a("v-uni-view",{staticClass:"nav-bar-title"},[e._v("积分充值")])],1),a("v-uni-view",{staticClass:"integral-container"},[a("v-uni-view",{staticStyle:{display:"flex",color:"#fff"}},[a("v-uni-view",{staticClass:"integral-header"},[a("v-uni-view",{staticStyle:{"line-height":"37px"}},[e._v("积分余额")]),a("v-uni-view",{staticStyle:{"font-size":"20px"}},[e._v(e._s(e.info.user_points))])],1),a("v-uni-view",{staticStyle:{flex:"1"}}),a("v-uni-view",{staticStyle:{"margin-top":"20px",width:"115px"}},[a("v-uni-view",{staticStyle:{display:"flex"}},["普通会员"!==e.info.member?a("v-uni-image",{staticClass:"vip-icon",attrs:{src:"/static/royal-vip.png"}}):a("v-uni-image",{staticClass:"vip-icon",attrs:{src:"/static/royal.png"}}),a("v-uni-view",{staticClass:"vip-type"},[e._v(e._s(e.info.member))])],1),a("v-uni-view",{staticClass:"vip-desc"},[e._v(e._s(1===e.info.discount?"":"可享"+10*e.info.discount+"折充值优惠"))])],1)],1),a("v-uni-view",{staticClass:"integral-content"},[a("v-uni-view",{staticClass:"integral-list"},e._l(e.packages,(function(t){return a("v-uni-view",{key:t.id,staticClass:"integral-item",class:{"integral-active":t.id===e.selectedPackage.id},on:{click:function(a){arguments[0]=a=e.$handleEvent(a),e.changePackage(t)}}},[a("v-uni-view",{staticStyle:{display:"flex","align-items":"center"}},[a("v-uni-view",{staticClass:"integral-name"},[e._v(e._s(t.points))]),t.id===e.selectedPackage.id?a("v-uni-image",{staticClass:"integral-icon",attrs:{src:"/static/amount-active.png"}}):a("v-uni-image",{staticClass:"integral-icon",attrs:{src:"/static/amount.png"}})],1),a("v-uni-view",{staticClass:"integral-price"},[e._v(e._s(t.price)+"￥")])],1)})),1),a("v-uni-view",{staticClass:"top_up-desc"},[a("v-uni-view",{staticStyle:{"margin-bottom":"5px"}},[e._v("充值说明：")]),a("v-uni-view",[e._v("1.充值未完成时，请不要切换账户或者退出软件，请等待充值结束，否则可能会出现账户未到账的情况。若出现此类情况，请咨询客服。")]),a("v-uni-view",[e._v("2.充值成功后不可提现，如其他问题，请联系客服。")]),a("v-uni-view",[e._v("3.如特殊情况需要退款，请联系客服。")])],1)],1),a("v-uni-button",{staticClass:"buy-btn",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.getWeChatCode.apply(void 0,arguments)}}},[e._v("立即购买")]),a("v-uni-view",{staticClass:"integral-footer"},[e._v("购买即同意"),a("v-uni-view",{on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.goto("/pages/agreement/membership?back=integral")}}},[e._v("《付费服务协议》")]),e._v("、"),a("v-uni-view",{on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.goto("/pages/agreement/user?back=integral")}}},[e._v("《用户协议》")]),e._v("与"),a("v-uni-view",{on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.goto("/pages/agreement/privacy?back=integral")}}},[e._v("《隐私条款》")])],1)],1)],1)},c=[]},"26b0":function(e,t,a){"use strict";a("6a54");var i=a("f5bd").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=i(a("2634")),c=i(a("2fdc"));a("5c47"),a("0506"),a("a1c1"),a("c223"),a("23f4"),a("7d2f"),a("9c4e"),a("ab80"),a("d4b5"),a("aa77"),a("bf0f");var r={name:"Integral",data:function(){return{safeAreaHeight:uni.getSystemInfoSync().safeArea.height,info:{},packages:[],selectedPackage:{},jssdkConfig:null}},onLoad:function(){this.queryInfo(),this.checkWeChatCode()},beforeDestroy:function(){uni.removeStorageSync("packageId")},methods:{isWeChat:function(){return/MicroMessenger/i.test(navigator.userAgent)},initJSSDK:function(){var e=this;return(0,c.default)((0,n.default)().mark((function t(){var a,i;return(0,n.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.isWeChat()){t.next=15;break}return t.prev=1,a=window.location.href.split("#")[0],t.next=5,e.$http.get("/getJSSDKConfig",{params:{url:a}});case 5:i=t.sent,e.jssdkConfig=i.data,wx.config({debug:!1,appId:e.jssdkConfig.appId,timestamp:e.jssdkConfig.timestamp,nonceStr:e.jssdkConfig.nonceStr,signature:e.jssdkConfig.signature,jsApiList:["chooseWXPay"]}),wx.ready((function(){console.log("JSSDK 初始化成功")})),wx.error((function(e){console.error("JSSDK 初始化失败",e)})),t.next=15;break;case 12:t.prev=12,t.t0=t["catch"](1),console.error("获取 JSSDK 配置信息失败",t.t0);case 15:case"end":return t.stop()}}),t,null,[[1,12]])})))()},initPayment:function(){var e=this;return(0,c.default)((0,n.default)().mark((function t(){var a,i;return(0,n.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.isWeChat()){t.next=15;break}return t.prev=1,a={user_id:uni.getStorageSync("userId"),package_id:uni.getStorageSync("packageId")},t.next=5,e.$http.post("/package/buy",a);case 5:i=t.sent,"success"===i.status?wx.chooseWXPay({timestamp:i.data.timeStamp,nonceStr:i.data.nonceStr,package:i.data.package,signType:i.data.signType,paySign:i.data.paySign,success:function(t){"chooseWXPay:ok"===t.errMsg?e.$tip.confirm("支付成功",!1).then((function(){e.queryInfo()})):e.$tip.confirm("支付失败",!1)},cancel:function(){e.$tip.confirm("已取消支付",!1)},fail:function(t){e.$tip.confirm("支付失败",!1)}}):e.$tip.confirm(i.message,!1),t.next=13;break;case 9:t.prev=9,t.t0=t["catch"](1),console.error("支付请求出错",t.t0),e.$tip.confirm("支付请求出错，请稍后重试",!1);case 13:t.next=16;break;case 15:e.$tip.confirm("需要在微信环境下才能使用",!1);case 16:case"end":return t.stop()}}),t,null,[[1,9]])})))()},getWeChatCode:function(){if(this.isWeChat()){var e=encodeURIComponent(window.location.href);uni.setStorageSync("redirectUri",window.location.href);window.location.replace("https://open.weixin.qq.com/connect/oauth2/authorize?appid=".concat("wx48d2e02bf10f849c","&redirect_uri=").concat(e,"&response_type=code&scope=").concat("snsapi_base","&state=").concat("STATE123","#wechat_redirect"))}else this.$tip.confirm("需要在微信环境下才能使用",!1)},getUrlCode:function(e){return decodeURIComponent((new RegExp("[?|&]"+e+"=([^&;]+?)(&|#|;|$)").exec(location.href)||[,""])[1].replace(/\+/g,"%20"))||null},checkWeChatCode:function(){var e=this,t=this.getUrlCode("code");if(t){var a={user_id:uni.getStorageSync("userId"),code:t,package_id:uni.getStorageSync("packageId")};this.$http.post("/package/buy",a).then((function(t){if("success"!==t.status)window.history.replaceState({},"","https://tellai.tech/#/pages/user/integral"),e.$tip.confirm(t.message,!1);else{var a=e;a.$tip.confirm(JSON.stringify(t.data),!1)}}))}},queryInfo:function(){var e=this,t={user_id:uni.getStorageSync("userId"),type:"token"};this.$http.get("/package/query/user",t).then((function(t){"success"===t.status?(e.info=t.data.user_info,console.log(e.info),e.packages=t.data.packages,uni.getStorageSync("packageId")?e.selectedPackage=e.packages.find((function(e){return e.id===uni.getStorageSync("packageId")})):(e.selectedPackage=e.packages[0]||{},uni.setStorageSync("packageId",e.selectedPackage.id))):e.$tip.confirm(t.message,!1)}))},changePackage:function(e){this.selectedPackage=e,uni.setStorageSync("packageId",e.id)},goto:function(e){uni.redirectTo({url:e})},back:function(){uni.switchTab({url:"/pages/user/index"})}}};t.default=r},"39fb":function(e,t,a){"use strict";var i=a("7efd"),n=a.n(i);n.a},"52a9":function(e,t,a){var i=a("c86c");t=i(!1),t.push([e.i,".integral[data-v-ffe81144]{height:100vh}.integral-container[data-v-ffe81144]{height:calc(100% - 56px);overflow-y:auto}.integral-header[data-v-ffe81144]{display:flex;flex-direction:column;align-items:center;padding:0 10px;box-sizing:border-box}.vip-icon[data-v-ffe81144]{width:20px;height:20px;margin-right:5px}.vip-type[data-v-ffe81144]{line-height:20px;height:20px}.vip-desc[data-v-ffe81144]{font-size:14px;color:#af8a18;height:20px;margin-top:5px}.integral-content[data-v-ffe81144]{height:calc(100% - 195px);min-height:400px;margin-top:10px;border-radius:15px;background:linear-gradient(180deg,rgba(233,157,66,.2),rgba(233,157,157,0));box-shadow:2px 4px 10px rgba(0,0,0,.4);padding:20px 5px 5px;box-sizing:border-box}.integral-list[data-v-ffe81144]{display:grid;grid-template-columns:repeat(auto-fill,minmax(108px,1fr));grid-auto-rows:92px;gap:12px}.integral-item[data-v-ffe81144]{border-radius:15px;background-color:hsla(0,0%,100%,.25);display:flex;flex-direction:column;justify-content:center;align-items:center;color:#fff}.integral-active[data-v-ffe81144]{background-color:rgba(225,197,156,.93)!important;color:#96750e!important}.integral-name[data-v-ffe81144]{line-height:30px;font-size:20px}.integral-icon[data-v-ffe81144]{width:16px;height:16px;margin-left:2px}.integral-price[data-v-ffe81144]{font-size:14px;color:#fff}.top_up-desc[data-v-ffe81144]{color:#cecece;margin-top:15px;padding:0 10px;box-sizing:border-box}.buy-btn[data-v-ffe81144]{background-color:#e99d42;width:255px;height:35px;line-height:35px;margin:20px auto 0;font-size:14px;border-radius:10px;color:#101010}.integral-footer[data-v-ffe81144]{color:#9a9a9a;font-size:13px;margin:20px 0;display:flex;justify-content:center}",""]),e.exports=t},"77e5":function(e,t,a){"use strict";a.r(t);var i=a("19c3"),n=a("ccb4");for(var c in n)["default"].indexOf(c)<0&&function(e){a.d(t,e,(function(){return n[e]}))}(c);a("39fb");var r=a("828b"),o=Object(r["a"])(n["default"],i["b"],i["c"],!1,null,"ffe81144",null,!1,i["a"],void 0);t["default"]=o.exports},"7efd":function(e,t,a){var i=a("52a9");i.__esModule&&(i=i.default),"string"===typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);var n=a("967d").default;n("2676d054",i,!0,{sourceMap:!1,shadowMode:!1})},ccb4:function(e,t,a){"use strict";a.r(t);var i=a("26b0"),n=a.n(i);for(var c in i)["default"].indexOf(c)<0&&function(e){a.d(t,e,(function(){return i[e]}))}(c);t["default"]=n.a}}]);