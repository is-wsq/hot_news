(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-template-recorder"],{"0e66":function(e,t,i){"use strict";i.r(t);var o=i("5d97"),r=i.n(o);for(var n in o)["default"].indexOf(n)<0&&function(e){i.d(t,e,(function(){return o[e]}))}(n);t["default"]=r.a},"2d5b":function(e,t,i){"use strict";i.d(t,"b",(function(){return r})),i.d(t,"c",(function(){return n})),i.d(t,"a",(function(){return o}));var o={uniIcons:i("00f9").default},r=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-uni-view",{staticClass:"pages recorder"},[i("v-uni-view",{staticClass:"nav-bar-header"},[i("uni-icons",{staticClass:"nav-bar-back",attrs:{type:"left",size:"21",color:"#ffffff"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.back.apply(void 0,arguments)}}}),i("v-uni-view",{staticClass:"nav-bar-title"},[e._v("在线录制")])],1),i("v-uni-view",{staticClass:"autocue"}),i("v-uni-view",{staticClass:"recorder-audio"},[i("v-uni-audio",{attrs:{src:e.audioUrl,controls:!0}})],1),i("v-uni-view",{staticClass:"recorder-box"},[i("v-uni-canvas",{ref:"canvas",attrs:{width:"100%",height:"100%"}}),i("v-uni-view",{staticClass:"recorder-btn"},[e.recorder?i("uni-icons",{attrs:{type:"micoff-filled",size:"30",color:"#ffffff"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.stopRecording.apply(void 0,arguments)}}}):i("uni-icons",{staticStyle:{border:"1px solid #ffffff"},attrs:{type:"mic-filled",size:"30",color:"#ffffff"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.startRecording.apply(void 0,arguments)}}})],1)],1)],1)},n=[]},"5d97":function(e,t,i){"use strict";i("6a54"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,i("c9b5"),i("bf0f"),i("ab80"),i("c223"),i("20f3"),i("18f7"),i("de6c"),i("dc89"),i("2425"),i("4ec3");var o="Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJodHRwczovL2xpdmUudGVsbGFpLnRlY2giLCJzdWIiOiI3ODNjNGI1NC1hMWQwLTVmY2ItOTExZC1kNWM1YjNjODY2MTAiLCJpYXQiOjE3NDIyMTA0NDQsImV4cCI6MTc1OTc5NTIwMCwibmFtZSI6InRlc3QifQ.OGrW6VfdM7zLVcGjGz9UHblQQlQoHWSriFB90kJOq98",r={data:function(){return{recorder:null,audioUrl:""}},beforeDestroy:function(){this.recorder&&this.recorder.close()},methods:{generateUniqueId:function(){return Date.now()+Math.random().toString(36).substr(2,16)},handlerUpload:function(){var e=this,t=this;uni.request({url:"https://live.tellai.tech/api/media/files/upload_request?type=audio",header:{Authorization:o},success:function(i){var r=i.data.base_resp,n=i.data.data;if(200===r.status_code){var a={name:"录制.wav",type:"voice",id:t.generateUniqueId()};t.$store.dispatch("task/addTask",a),t.$tip.confirm("已创建音色克隆任务\n《录制.wav》",!1).then((function(e){uni.redirectTo({url:"/pages/template/voice"})})),uni.uploadFile({url:n.upload_url,file:e.file,name:"file",header:{Authorization:o},timeout:18e5,formData:{file_id:n.file_id,type:"audio"},success:function(e){var i=JSON.parse(e.data).base_resp,o=JSON.parse(e.data).data;200===i.status_code?t.clone(o.file_id,a):(t.$store.dispatch("task/removeTask",a.id),t.$tip.confirm("".concat(a.name,"音色克隆任务失败,").concat(i.status_msg),!1))}})}else e.$tip.confirm(r.status_msg,!1)}})},clone:function(e,t){var i=this,o={file_id:e,user_id:uni.getStorageSync("userId"),audio_name:t.name.substring(0,t.name.lastIndexOf("."))};this.$http.post("/timbres/clone/file_id",o).then((function(e){i.$store.dispatch("task/removeTask",t.id),"success"===e.status?i.$tip.confirm("".concat(t.name,"音色克隆任务成功"),!1):i.$tip.confirm("".concat(t.name,"音色克隆任务失败,").concat(e.message),!1)}))},startRecording:function(){var e=this;window.Recorder?(this.recorder=window.Recorder({type:"wav",sampleRate:16e3,bitRate:16}),this.recorder.open((function(){e.recorder.start(),uni.showToast({title:"录音中...",icon:"none"})}),(function(e,t){console.error("录音授权失败:",e),uni.showToast({title:"录音失败",icon:"none"})}))):uni.showToast({title:"录音库未加载",icon:"none"})},stopRecording:function(){var e=this;this.recorder&&this.recorder.stop((function(t,i){e.audioUrl=URL.createObjectURL(t),e.recorder.close(),e.file=new File([t],"recording.wav",{type:"audio/wav"}),console.log(e.file)}),(function(e){console.error("停止失败:",e),uni.showToast({title:"停止失败",icon:"none"})}))},back:function(){uni.redirectTo({url:"/pages/template/voicesClone"})}}};t.default=r},"6f92":function(e,t,i){var o=i("c86c");t=o(!1),t.push([e.i,".recorder[data-v-3d37c083]{height:100vh}.autocue[data-v-3d37c083]{height:200px;border-radius:10px;background-color:#f5f5f5}.recorder-audio[data-v-3d37c083]{height:200px;display:flex;justify-content:center;align-items:center;border:1px solid red}.recorder-box[data-v-3d37c083]{height:calc(100vh - 465px);border:1px solid red;position:relative}.recorder-btn[data-v-3d37c083]{position:absolute;bottom:0;height:100px;width:100%;border:1px solid #ff0;display:flex;justify-content:center;align-items:center}",""]),e.exports=t},ccd2:function(e,t,i){var o=i("6f92");o.__esModule&&(o=o.default),"string"===typeof o&&(o=[[e.i,o,""]]),o.locals&&(e.exports=o.locals);var r=i("967d").default;r("3893bd21",o,!0,{sourceMap:!1,shadowMode:!1})},cd5f:function(e,t,i){"use strict";i.r(t);var o=i("2d5b"),r=i("0e66");for(var n in r)["default"].indexOf(n)<0&&function(e){i.d(t,e,(function(){return r[e]}))}(n);i("fac2");var a=i("828b"),c=Object(a["a"])(r["default"],o["b"],o["c"],!1,null,"3d37c083",null,!1,o["a"],void 0);t["default"]=c.exports},fac2:function(e,t,i){"use strict";var o=i("ccd2"),r=i.n(o);r.a}}]);