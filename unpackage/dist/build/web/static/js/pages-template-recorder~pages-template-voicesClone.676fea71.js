(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-template-recorder~pages-template-voicesClone"],{"0b46":function(e,t,n){"use strict";var r=n("6a50");r("Int8",(function(e){return function(t,n,r){return e(this,t,n,r)}}))},"20f3":function(e,t,n){"use strict";var r=n("8bdb"),a=n("5145");r({target:"Array",proto:!0,forced:a!==[].lastIndexOf},{lastIndexOf:a})},"2d48":function(e,t,n){"use strict";var r=n("6a50");r("Int16",(function(e){return function(t,n,r){return e(this,t,n,r)}}))},"4ec3":function(e,t,n){(function(e){var r,a=n("bdbb").default;n("d4b5"),n("aa9c"),n("dd2b"),n("4db2"),n("bf0f"),n("2d48"),n("4d8f"),n("7b97"),n("668a"),n("c5b7"),n("8ff5"),n("2378"),n("641a"),n("64e0"),n("cce3"),n("efba"),n("d009"),n("bd7d"),n("7edd"),n("d798"),n("f547"),n("5e54"),n("b60a"),n("8c18"),n("12973"),n("f991"),n("198e"),n("8557"),n("63b1"),n("1954"),n("1cf1"),n("5c47"),n("a1c1"),n("c9b5"),n("ab80"),n("4f9b"),n("f7a5"),n("d5c6"),n("5a56"),n("f074"),n("c976"),n("8f71"),n("0506"),n("0b46"),n("c02e"),n("80e3"),n("dc69"),n("825c"),n("e966"),n("7a76"),n("5ef2"),function(o){var i="object"==("undefined"===typeof window?"undefined":a(window))&&!!window.document,s=i?window:Object;!function(e,t){"use strict";var n=function(){},r=function(e){return"number"==typeof e},o=function(e){return JSON.stringify(e)},i=function(e){return new D(e)},s=i.LM="2025-01-11 09:28",c="https://github.com/xiangyuecn/Recorder",f="Recorder",u="getUserMedia",l="srcSampleRate",v="sampleRate",p="bitRate",h="catch",d=e[f];if(d&&d.LM==s)return d.CLog(d.i18n.$T("K8zP::重复导入{1}",0,f),3);i.IsOpen=function(){var e=i.Stream;if(e){var t=T(e),n=t[0];if(n){var r=n.readyState;return"live"==r||r==n.LIVE}}return!1},i.BufferSize=4096,i.Destroy=function(){for(var e in A(f+" Destroy"),I(),g)g[e]()};var g={};i.BindDestroy=function(e,t){g[e]=t},i.Support=function(){if(!t)return!1;var e=navigator.mediaDevices||{};return e[u]||(e=navigator)[u]||(e[u]=e.webkitGetUserMedia||e.mozGetUserMedia||e.msGetUserMedia),!!e[u]&&(i.Scope=e,!!i.GetContext())},i.GetContext=function(e){if(!t)return null;var n=window.AudioContext;if(n||(n=window.webkitAudioContext),!n)return null;var r=i.Ctx,a=0;return r||(r=i.Ctx=new n,a=1,i.NewCtxs=i.NewCtxs||[],i.BindDestroy("Ctx",(function(){var e=i.Ctx;e&&e.close&&(m(e),i.Ctx=0);var t=i.NewCtxs;i.NewCtxs=[];for(var n=0;n<t.length;n++)m(t[n])}))),e&&r.close&&(a||(r._useC||m(r),r=new n),r._useC=1,i.NewCtxs.push(r)),r},i.CloseNewCtx=function(e){if(e&&e.close){m(e);for(var t=i.NewCtxs||[],n=t.length,r=0;r<t.length;r++)if(t[r]==e){t.splice(r,1);break}A(P("mSxV::剩{1}个GetContext未close",0,n+"-1="+t.length),t.length?3:0)}};var m=function(e){if(e&&e.close&&!e._isC&&(e._isC=1,"closed"!=e.state))try{e.close()}catch(e){A("ctx close err",1,e)}},b=i.ResumeCtx=function(e,t,n,r){var a=0,o=0,i=0,s=0,c="EventListener",f="ResumeCtx ",u=function(t,f){o&&l(),a||(a=1,t&&r(t,s),f&&n(s)),f&&(!e._LsSC&&e["add"+c]&&e["add"+c]("statechange",v),e._LsSC=1,i=1)},l=function(e){if(!e||!o){o=e?1:0;for(var t=["focus","mousedown","mouseup","touchstart","touchend"],n=0;n<t.length;n++)window[(e?"add":"remove")+c](t[n],v,!0)}},v=function(){var n=e.state,r=C(n);if(!a&&!t(r?++s:s))return u();r?(i&&A(f+"sc "+n,3),l(1),e.resume().then((function(){i&&A(f+"sc "+e.state),u(0,1)}))[h]((function(t){A(f+"error",1,t),C(e.state)||u(t.message||"error")}))):"closed"==n?(i&&!e._isC&&A(f+"sc "+n,1),u("ctx closed")):u(0,1)};v()},C=i.CtxSpEnd=function(e){return"suspended"==e||"interrupted"==e},_=function(e){var t=e.state,n="ctx.state="+t;return C(t)&&(n+=P("nMIy::（注意：ctx不是running状态，rec.open和start至少要有一个在用户操作(触摸、点击等)时进行调用，否则将在rec.start时尝试进行ctx.resume，可能会产生兼容性问题(仅iOS)，请参阅文档中runningContext配置）")),n},w="ConnectEnableWebM";i[w]=!0;var y="ConnectEnableWorklet";i[y]=!1;var S=function(e){var t=e.BufferSize||i.BufferSize,n=e.Stream,r=n._c,a=r[v],s={},c=T(n),u=c[0],l=null,p="";if(u&&u.getSettings){var d=(l=u.getSettings())[v];d&&d!=a&&(p=P("eS8i::Stream的采样率{1}不等于{2}，将进行采样率转换（注意：音质不会变好甚至可能变差），主要在移动端未禁用回声消除时会产生此现象，浏览器有回声消除时可能只会返回16k采样率的音频数据，",0,d,a))}n._ts=l,A(p+"Stream TrackSet: "+o(l),p?3:0);var g,m,C,_=function(e){var t=n._m=r.createMediaStreamSource(n),a=r.destination,o="createMediaStreamDestination";r[o]&&(a=n._d=r[o]()),t.connect(e),e.connect(a)},S="",x=n._call,I=function(e,t){for(var n in x){if(t!=a){s.index=0;var r=(s=i.SampleData([e],t,a,s,{_sum:1})).data,o=s._sum}else{s={};for(var c=e.length,f=(r=new Int16Array(c),o=0,0);f<c;f++){var u=Math.max(-1,Math.min(1,e[f]));u=u<0?32768*u:32767*u,r[f]=u,o+=Math.abs(u)}}for(var l in x)x[l](r,o);return}},L="ScriptProcessor",R="audioWorklet",O=f+" "+R,D="RecProc",F="MediaRecorder",E=F+".WebM.PCM",G=r.createScriptProcessor||r.createJavaScriptNode,N=P("ZGlf::。由于{1}内部1秒375次回调，在移动端可能会有性能问题导致回调丢失录音变短，PC端无影响，暂不建议开启{1}。",0,R),W=function(){m=n.isWorklet=!1,M(n),A(P("7TU0::Connect采用老的{1}，",0,L)+U.get(P(i[y]?"JwCL::但已设置{1}尝试启用{2}":"VGjB::可设置{1}尝试启用{2}",2),[f+"."+y+"=true",R])+S+N,3);var e=n._p=G.call(r,t,1,1);_(e),e.onaudioprocess=function(e){var t=e.inputBuffer.getChannelData(0);I(t,a)}},B=function(){g=n.isWebM=!1,k(n),m=n.isWorklet=!G||i[y];var e=window.AudioWorkletNode;if(m&&r[R]&&e){var o=function(){return m&&n._na},s=n._na=function(){""!==C&&(clearTimeout(C),C=setTimeout((function(){C=0,o()&&(A(P("MxX1::{1}未返回任何音频，恢复使用{2}",0,R,L),3),G&&W())}),500))},c=function(){if(o()){var i=n._n=new e(r,D,{processorOptions:{bufferSize:t}});_(i),i.port.onmessage=function(e){C&&(clearTimeout(C),C=""),o()?I(e.data.val,a):m||A(P("XUap::{1}多余回调",0,R),3)},A(P("yOta::Connect采用{1}，设置{2}可恢复老式{3}",0,R,f+"."+y+"=false",L)+S+N,3)}},u=function(){if(o())if(r[D])c();else{var e,t,n=(t="class "+D+" extends AudioWorkletProcessor{",t+="constructor "+(e=function(e){return e.toString().replace(/^function|DEL_/g,"").replace(/\$RA/g,O)})((function(e){DEL_super(e);var t=this,n=e.processorOptions.bufferSize;t.bufferSize=n,t.buffer=new Float32Array(2*n),t.pos=0,t.port.onmessage=function(e){e.data.kill&&(t.kill=!0,$C.log("$RA kill call"))},$C.log("$RA .ctor call",e)})),t+="process "+e((function(e,t,n){var r=this,a=r.bufferSize,o=r.buffer,i=r.pos;if((e=(e[0]||[])[0]||[]).length){o.set(e,i);var s=~~((i+=e.length)/a)*a;if(s){this.port.postMessage({val:o.slice(0,s)});var c=o.subarray(s,i);(o=new Float32Array(2*a)).set(c),i=c.length,r.buffer=o}r.pos=i}return!r.kill})),t=(t+='}try{registerProcessor("'+D+'", '+D+')}catch(e){$C.error("'+O+' Reg Error",e)}').replace(/\$C\./g,"console."),"data:text/javascript;base64,"+btoa(unescape(encodeURIComponent(t))));r[R].addModule(n).then((function(e){o()&&(r[D]=1,c(),C&&s())}))[h]((function(e){A(R+".addModule Error",1,e),o()&&W()}))}};b(r,(function(){return o()}),u,u)}else W()};!function(){var e=window[F],r="ondataavailable",a="audio/webm; codecs=pcm";g=n.isWebM=i[w];var o=e&&r in e.prototype&&e.isTypeSupported(a);if(S=o?"":P("VwPd::（此浏览器不支持{1}）",0,E),!g||!o)return B();var s=function(){return g&&n._ra};n._ra=function(){""!==C&&(clearTimeout(C),C=setTimeout((function(){s()&&(A(P("vHnb::{1}未返回任何音频，降级使用{2}",0,F,R),3),B())}),500))};var c=Object.assign({mimeType:a},i.ConnectWebMOptions),u=n._r=new e(n,c),l=n._rd={};u[r]=function(e){var t=new FileReader;t.onloadend=function(){if(s()){var e=z(new Uint8Array(t.result),l);if(!e)return;if(-1==e)return void B();C&&(clearTimeout(C),C=""),I(e,l.webmSR)}else g||A(P("O9P7::{1}多余回调",0,F),3)},t.readAsArrayBuffer(e.data)};try{u.start(~~(t/48)),A(P("LMEm::Connect采用{1}，设置{2}可恢复使用{3}或老式{4}",0,E,f+"."+w+"=false",R,L))}catch(e){A("mr start err",1,e),B()}}()},x=function(e){e._na&&e._na(),e._ra&&e._ra()},M=function(e){e._na=null,e._n&&(e._n.port.postMessage({kill:!0}),e._n.disconnect(),e._n=null)},k=function(e){if(e._ra=null,e._r){try{e._r.stop()}catch(e){A("mr stop err",1,e)}e._r=null}},I=function(e){var t=(e=e||i)==i,n=e.Stream;n&&(n._m&&(n._m.disconnect(),n._m=null),!n._RC&&n._c&&i.CloseNewCtx(n._c),n._RC=null,n._c=null,n._d&&(L(n._d.stream),n._d=null),n._p&&(n._p.disconnect(),n._p.onaudioprocess=n._p=null),M(n),k(n),t&&L(n)),e.Stream=0},L=i.StopS_=function(e){for(var t=T(e),n=0;n<t.length;n++){var r=t[n];r.stop&&r.stop()}e.stop&&e.stop()},T=function(e){var t=0,n=0,r=[];e.getAudioTracks&&(t=e.getAudioTracks(),n=e.getVideoTracks()),t||(t=e.audioTracks,n=e.videoTracks);for(var a=0,o=t?t.length:0;a<o;a++)r.push(t[a]);for(a=0,o=n?n.length:0;a<o;a++)r.push(n[a]);return r};i.SampleData=function(e,t,n,r,a){var o="SampleData";r||(r={});var s=r.index||0,c=r.offset||0,f=r.raisePrev||0,u=r.filter;if(u&&u.fn&&(u.sr&&u.sr!=t||u.srn&&u.srn!=n)&&(u=null,A(P("d48C::{1}的filter采样率变了，重设滤波",0,o),3)),!u)if(n<=t){var l=3*t/4<n?0:n/2*3/4;u={fn:l?i.IIRFilter(!0,t,l):0}}else{l=3*n/4<t?0:t/2*3/4;u={fn:l?i.IIRFilter(!0,n,l):0}}u.sr=t,u.srn=n;var v=u.fn,p=r.frameNext||[];a||(a={});var h=a.frameSize||1;a.frameType&&(h="mp3"==a.frameType?1152:1);var d=a._sum,g=0,m=e.length;m+1<s&&A(P("tlbC::{1}似乎传入了未重置chunk {2}",0,o,s+">"+m),3);for(var b=0,C=s;C<m;C++)b+=e[C].length;var _=t/n;if(1<_)b=Math.max(0,b-Math.floor(c)),b=Math.floor(b/_);else if(_<1){var w=1/_;b=Math.floor(b*w)}b+=p.length;var y=new Int16Array(b),S=0;for(C=0;C<p.length;C++)y[S]=p[C],S++;for(;s<m;s++){var x=e[s],M=x instanceof Float32Array,k=(C=c,x.length),I=v&&v.Embed,L=0,T=0,R=0,O=0;if(_<1){for(var D=S+C,z=f,F=0;F<k;F++){var E=x[F];M&&(E=(E=Math.max(-1,Math.min(1,E)))<0?32768*E:32767*E);var G=Math.floor(D);D+=w;for(var N=Math.floor(D),U=(E-z)/(N-G),W=1;G<N;G++,W++){var B=Math.floor(z+W*U);I?(R=B,O=I.b0*R+I.b1*I.x1+I.b0*I.x2-I.a1*I.y1-I.a2*I.y2,I.x2=I.x1,I.x1=R,I.y2=I.y1,I.y1=O,B=O):B=v?v(B):B,32767<B?B=32767:B<-32768&&(B=-32768),d&&(g+=Math.abs(B)),y[G]=B,S++}z=f=E,C+=w}c=C%1}else{F=0;for(var $=0;F<k;F++,$++){if($<k){E=x[$];M&&(E=(E=Math.max(-1,Math.min(1,E)))<0?32768*E:32767*E),I?(R=E,O=I.b0*R+I.b1*I.x1+I.b0*I.x2-I.a1*I.y1-I.a2*I.y2,I.x2=I.x1,I.x1=R,I.y2=I.y1,I.y1=O):O=v?v(E):E}if(L=T,T=O,0!=$){var V=Math.floor(C);if(F==V){var j=Math.ceil(C),J=C-V,H=L,K=j<k?T:H,Q=H+(K-H)*J;32767<Q?Q=32767:Q<-32768&&(Q=-32768),d&&(g+=Math.abs(Q)),y[S]=Q,S++,C+=_}}else F--}c=Math.max(0,C-k)}}_<1&&S+1==b&&(b--,y=new Int16Array(y.buffer.slice(0,2*b))),S-1!=b&&S!=b&&A(o+" idx:"+S+" != size:"+b,3),p=null;var X=b%h;if(0<X){var q=2*(b-X);p=new Int16Array(y.buffer.slice(q)),y=new Int16Array(y.buffer.slice(0,q))}var Y={index:s,offset:c,raisePrev:f,filter:u,frameNext:p,sampleRate:n,data:y};return d&&(Y._sum=g),Y},i.IIRFilter=function(e,t,n){var r=2*Math.PI*n/t,a=Math.sin(r),o=Math.cos(r),i=a/2,s=1+i,c=-2*o/s,f=(1-i)/s;if(e)var u=(1-o)/2/s,l=(1-o)/s;else u=(1+o)/2/s,l=-(1+o)/s;var v=0,p=0,h=0,d=0,g=0,m=function(e){return h=u*e+l*v+u*p-c*d-f*g,p=v,v=e,g=d,d=h};return m.Embed={x1:0,x2:0,y1:0,y2:0,b0:u,b1:l,a1:c,a2:f},m},i.PowerLevel=function(e,t){var n=e/t||0;return n<1251?Math.round(n/1250*10):Math.round(Math.min(100,Math.max(0,100*(1+Math.log(n/1e4)/Math.log(10)))))},i.PowerDBFS=function(e){var t=Math.max(.1,e||0);return t=Math.min(t,32767),t=20*Math.log(t/32767)/Math.log(10),Math.max(-100,Math.round(t))},i.CLog=function(e,t){if("object"==("undefined"===typeof console?"undefined":a(console))){var n=new Date,o=("0"+n.getMinutes()).substr(-2)+":"+("0"+n.getSeconds()).substr(-2)+"."+("00"+n.getMilliseconds()).substr(-3),s=this&&this.envIn&&this.envCheck&&this.id,c=["["+o+" "+f+(s?":"+s:"")+"]"+e],u=arguments,l=i.CLog,v=2,p=l.log||console.log;for(r(t)?p=1==t?l.error||console.error:3==t?l.warn||console.warn:p:v=1;v<u.length;v++)c.push(u[v]);R?p&&p("[IsLoser]"+c[0],1<c.length?c:""):p.apply(console,c)}};var A=function(){i.CLog.apply(this,arguments)},R=!0;try{R=!console.log.apply}catch(e){}var O=0;function D(e){var t=this;t.id=++O,W();var a={type:"mp3",onProcess:n};for(var o in e)a[o]=e[o];var i=(t.set=a)[p],s=a[v];(i&&!r(i)||s&&!r(s))&&t.CLog(P.G("IllegalArgs-1",[P("VtS4::{1}和{2}必须是数值",0,v,p)]),1,e),a[p]=+i||16,a[v]=+s||16e3,t.state=0,t._S=9,t.Sync={O:9,C:9}}i.Sync={O:9,C:9},i.prototype=D.prototype={CLog:A,_streamStore:function(){return this.set.sourceStream?this:i},_streamGet:function(){return this._streamStore().Stream},_streamCtx:function(){var e=this._streamGet();return e&&e._c},open:function(e,r){var f=this,l=f.set,p=f._streamStore(),d=0;e=e||n;var g=function(e,t){t=!!t,f.CLog(P("5tWi::录音open失败：")+e+",isUserNotAllow:"+t,1),d&&i.CloseNewCtx(d),r&&r(e,t)};f._streamTag=u;var m=function(){f.CLog("open ok, id:"+f.id+" stream:"+f._streamTag),e(),f._SO=0},b=p.Sync,C=++b.O,w=b.C;if(f._O=f._O_=C,f._SO=f._S,t){var y=f.envCheck({envName:"H5",canProcess:!0});if(y)g(P("A5bm::不能录音：")+y);else{var x,M=function(){(x=l.runningContext)||(x=d=i.GetContext(!0))};if(l.sourceStream){if(f._streamTag="set.sourceStream",!i.GetContext())return void g(P("1iU7::不支持此浏览器从流中获取录音"));M(),I(p);var k=f.Stream=l.sourceStream;k._c=x,k._RC=l.runningContext,k._call={};try{S(p)}catch(e){return I(p),void g(P("BTW2::从流中打开录音失败：")+e.message)}m()}else{var L=function(e,t){try{window.top.a}catch(e){return void g(P("Nclz::无权录音(跨域，请尝试给iframe添加麦克风访问策略，如{1})",0,'allow="camera;microphone"'))}T(1,e)&&(/Found/i.test(e)?g(t+P("jBa9::，无可用麦克风")):g(t))},T=function(e,t){if(/Permission|Allow/i.test(t))e&&g(P("gyO5::用户拒绝了录音权限"),!0);else{if(!1!==window.isSecureContext)return 1;e&&g(P("oWNo::浏览器禁止不安全页面录音，可开启https解决"))}};if(i.IsOpen())m();else if(i.Support()){M();var A,R,O=function(e){setTimeout((function(){e._call={};var t=i.Stream;t&&(I(),e._call=t._call),(i.Stream=e)._c=x,e._RC=l.runningContext,function(){if(w!=b.C||!f._O){var e=P("dFm8::open被取消");return C==b.O?f.close():e=P("VtJO::open被中断"),g(e),!0}}()||(i.IsOpen()?(t&&f.CLog(P("upb8::发现同时多次调用open"),1),S(p),m()):g(P("Q1GA::录音功能无效：无音频流")))}),100)},D=function(e){var t=e.name||e.message||e.code+":"+e,n="";1==z&&T(0,t)&&(n=P("KxE2::，将尝试禁用回声消除后重试"));var r=P("xEQR::请求录音权限错误"),a=P("bDOG::无法录音：");f.CLog(r+n+"|"+e,n||R?3:1,e),n?(A=t,R=e,F(1)):R?(f.CLog(r+"|"+R,1,R),L(A,a+R)):L(t,a+e)},z=0,F=function(e){z++;var t="audioTrackSet",n=JSON.parse(o(l[t]||!0));f.CLog("open... "+z+" "+t+":"+o(n)),e&&("object"!=a(n)&&(n={}),n["autoGainControl"]=!1,n["echoCancellation"]=!1,n["noiseSuppression"]=!1),n[v]&&f.CLog(P("IjL3::注意：已配置{1}参数，可能会出现浏览器不能正确选用麦克风、移动端无法启用回声消除等现象",0,t+"."+v),3);var r={audio:n,video:l.videoTrackSet||!1};try{var p=i.Scope[u](r,O,D)}catch(e){f.CLog(u,3,e),r={audio:!0,video:!1},p=i.Scope[u](r,O,D)}f.CLog(u+"("+o(r)+") "+_(x)+P("RiWe::，未配置 {1} 时浏览器可能会自动启用回声消除，移动端未禁用回声消除时可能会降低系统播放音量（关闭录音后可恢复）和仅提供16k采样率的音频流（不需要回声消除时可明确配置成禁用来获得48k高音质的流），请参阅文档中{2}配置",0,"audioTrackSet:{echoCancellation,noiseSuppression,autoGainControl}",t)+"("+c+") LM:"+s+" UA:"+navigator.userAgent),p&&p.then&&p.then(O)[h](D)};F()}else L("",P("COxc::此浏览器不支持录音"))}}}else g(P.G("NonBrowser-1",["open"])+P("EMJq::，可尝试使用RecordApp解决方案")+"("+c+"/tree/master/app-support-sample)")},close:function(e){e=e||n;var t=this,r=t._streamStore();t._stop();var a=" stream:"+t._streamTag,o=r.Sync;if(t._O=0,t._O_!=o.O)return t.CLog(P("hWVz::close被忽略（因为同时open了多个rec，只有最后一个会真正close）")+a,3),void e();o.C++,I(r),t.CLog("close,"+a),e()},mock:function(e,t){var n=this;return n._stop(),n.isMock=1,n.mockEnvInfo=null,n.buffers=[e],n.recSize=e.length,n._setSrcSR(t),n._streamTag="mock",n},_setSrcSR:function(e){var t=this.set,n=t[v];e<n?t[v]=e:n=0,this[l]=e,this.CLog(l+": "+e+" set."+v+": "+t[v]+(n?" "+P("UHvm::忽略")+": "+n:""),n?3:0)},envCheck:function(e){var t,n=this.set,r="CPU_BE";if(t||i[r]||"function"!=typeof Int8Array||new Int8Array(new Int32Array([1]).buffer)[0]||(W(r),t=P("Essp::不支持{1}架构",0,r)),!t){var a=n.type,o=this[a+"_envCheck"];n.takeoffEncodeChunk&&(o?e.canProcess||(t=P("7uMV::{1}环境不支持实时处理",0,e.envName)):t=P("2XBl::{1}类型不支持设置takeoffEncodeChunk",0,a)+(this[a]?"":P("LG7e::(未加载编码器)"))),!t&&o&&(t=this[a+"_envCheck"](e,n))}return t||""},envStart:function(e,t){var n=this,r=n.set;if(n.isMock=e?1:0,n.mockEnvInfo=e,n.buffers=[],n.recSize=0,e&&(n._streamTag="env$"+e.envName),n.state=1,n.envInLast=0,n.envInFirst=0,n.envInFix=0,n.envInFixTs=[],n._setSrcSR(t),n.engineCtx=0,n[r.type+"_start"]){var a=n.engineCtx=n[r.type+"_start"](r);a&&(a.pcmDatas=[],a.pcmSize=0)}},envResume:function(){this.envInFixTs=[]},envIn:function(e,t){var n=this,r=n.set,a=n.engineCtx;if(1==n.state){var o=n[l],s=e.length,c=i.PowerLevel(t,s),f=n.buffers,u=f.length;f.push(e);var p=f,h=u,d=Date.now(),g=Math.round(s/o*1e3);n.envInLast=d,1==n.buffers.length&&(n.envInFirst=d-g);var m=n.envInFixTs;m.splice(0,0,{t:d,d:g});for(var b=d,C=0,_=0;_<m.length;_++){var w=m[_];if(3e3<d-w.t){m.length=_;break}b=w.t,C+=w.d}var y=m[1],S=d-b,x=S-C;if(S/3<x&&(y&&1e3<S||6<=m.length)){var M=d-y.t-g;if(g/5<M){var k=!r.disableEnvInFix;if(n.CLog("["+d+"]"+U.get(P(k?"4Kfd::补偿{1}ms":"bM5i::未补偿{1}ms",1),[M]),3),n.envInFix+=M,k){var I=new Int16Array(M*o/1e3);s+=I.length,f.push(I)}}}var L=n.recSize,T=s,A=L+T;if(n.recSize=A,a){var R=i.SampleData(f,o,r[v],a.chunkInfo);a.chunkInfo=R,L=a.pcmSize,T=R.data.length,A=L+T,a.pcmSize=A,f=a.pcmDatas,u=f.length,f.push(R.data),o=R[v]}var O=Math.round(A/o*1e3),D=f.length,z=p.length,F=function(){for(var e=E?0:-T,t=null==f[0],o=u;o<D;o++){var i=f[o];null==i?t=1:(e+=i.length,a&&i.length&&n[r.type+"_encode"](a,i))}if(t&&a){o=h;for(p[0]&&(o=0);o<z;o++)p[o]=null}t&&(e=E?T:0,f[0]=null),a?a.pcmSize+=e:n.recSize+=e},E=0,G="rec.set.onProcess";try{E=!0===(E=r.onProcess(f,c,O,o,u,F))}catch(e){console.error(G+P("gFUF::回调出错是不允许的，需保证不会抛异常"),e)}var N=Date.now()-d;if(10<N&&1e3<n.envInFirst-d&&n.CLog(G+P("2ghS::低性能，耗时{1}ms",0,N),3),E){var W=0;for(_=u;_<D;_++)null==f[_]?W=1:f[_]=new Int16Array(0);W?n.CLog(P("ufqH::未进入异步前不能清除buffers"),3):a?a.pcmSize-=T:n.recSize-=T}else F()}else n.state||n.CLog("envIn at state=0",3)},start:function(){var e=this,t=1;if(e.set.sourceStream?e.Stream||(t=0):i.IsOpen()||(t=0),t){var n=e._streamCtx();if(e.CLog(P("kLDN::start 开始录音，")+_(n)+" stream:"+e._streamTag),e._stop(),e.envStart(null,n[v]),e.state=3,e._SO&&e._SO+1!=e._S)e.CLog(P("Bp2y::start被中断"),3);else{e._SO=0;var r=function(){3==e.state&&(e.state=1,e.resume())},a="AudioContext resume: ",o=e._streamGet();o._call[e.id]=function(){e.CLog(a+n.state+"|stream ok"),r()},b(n,(function(t){return t&&e.CLog(a+"wait..."),3==e.state}),(function(t){t&&e.CLog(a+n.state),r()}),(function(t){e.CLog(a+n.state+P("upkE::，可能无法录音：")+t,1),r()}))}}else e.CLog(P("6WmN::start失败：未open"),1)},pause:function(){var e=this,t=e._streamGet();e.state&&(e.state=2,e.CLog("pause"),t&&delete t._call[e.id])},resume:function(){var e=this,t=e._streamGet(),n="resume(wait ctx)";if(3==e.state)e.CLog(n);else if(e.state){e.state=1,e.CLog("resume"),e.envResume(),t&&(t._call[e.id]=function(t,n){1==e.state&&e.envIn(t,n)},x(t));var r=e._streamCtx();r&&b(r,(function(t){return t&&e.CLog(n+"..."),1==e.state}),(function(a){a&&e.CLog(n+r.state),x(t)}),(function(t){e.CLog(n+r.state+"[err]"+t,1)}))}},_stop:function(e){var t=this,n=t.set;t.isMock||t._S++,t.state&&(t.pause(),t.state=0),!e&&t[n.type+"_stop"]&&(t[n.type+"_stop"](t.engineCtx),t.engineCtx=0)},stop:function(e,t,n){var r,a=this,o=a.set,u=a.envInLast-a.envInFirst,p=u&&a.buffers.length;a.CLog(P("Xq4s::stop 和start时差:")+(u?u+"ms "+P("3CQP::补偿:")+a.envInFix+"ms envIn:"+p+" fps:"+(p/u*1e3).toFixed(1):"-")+" stream:"+a._streamTag+" ("+c+") LM:"+s);var h=function(){a._stop(),n&&a.close()},d=function(e){a.CLog(P("u8JG::结束录音失败：")+e,1),t&&t(e),h()},g=function(t,n,s){var c="arraybuffer",u="dataType",l="DefaultDataType",v=a[u]||i[l]||"blob",p=u+"="+v,g=t instanceof ArrayBuffer,m=0,b=g?t.byteLength:t.size;if(v==c?g||(m=1):"blob"==v?"function"!=typeof Blob?m=P.G("NonBrowser-1",[p])+P("1skY::，请设置{1}",0,f+"."+l+'="'+c+'"'):(g&&(t=new Blob([t],{type:n})),t instanceof Blob||(m=1),n=t.type||n):m=P.G("NotSupport-1",[p]),a.CLog(P("Wv7l::结束录音 编码花{1}ms 音频时长{2}ms 文件大小{3}b",0,Date.now()-r,s,b)+" "+p+","+n),m)d(1!=m?m:P("Vkbd::{1}编码器返回的不是{2}",0,o.type,v)+", "+p);else{if(o.takeoffEncodeChunk)a.CLog(P("QWnr::启用takeoffEncodeChunk后stop返回的blob长度为0不提供音频数据"),3);else if(b<Math.max(50,s/5))return void d(P("Sz2H::生成的{1}无效",0,o.type));e&&e(t,s,n),h()}};if(!a.isMock){var m=3==a.state;if(!a.state||m)return void d(P("wf9t::未开始录音")+(m?P("Dl2c::，开始录音前无用户交互导致AudioContext未运行"):""))}a._stop(!0);var b=a.recSize;if(b)if(a[o.type]){if(a.isMock){var C=a.envCheck(a.mockEnvInfo||{envName:"mock",canProcess:!1});if(C)return void d(P("AxOH::录音错误：")+C)}var _=a.engineCtx;if(a[o.type+"_complete"]&&_){var w=Math.round(_.pcmSize/o[v]*1e3);return r=Date.now(),void a[o.type+"_complete"](_,(function(e,t){g(e,t,w)}),d)}if(r=Date.now(),a.buffers[0]){var y=i.SampleData(a.buffers,a[l],o[v]);o[v]=y[v];var S=y.data;w=Math.round(S.length/o[v]*1e3);a.CLog(P("CxeT::采样:{1} 花:{2}ms",0,b+"->"+S.length,Date.now()-r)),setTimeout((function(){r=Date.now(),a[o.type](S,(function(e,t){g(e,t,w)}),(function(e){d(e)}))}))}else d(P("xkKd::音频buffers被释放"))}else d(P("xGuI::未加载{1}编码器，请尝试到{2}的src/engine内找到{1}的编码器并加载",0,o.type,f));else d(P("Ltz3::未采集到录音"))}};var z=function(e,t){t.pos||(t.pos=[0],t.tracks={},t.bytes=[]);var n=t.tracks,r=[t.pos[0]],a=function(){t.pos[0]=r[0]},o=t.bytes.length,i=new Uint8Array(o+e.length);if(i.set(t.bytes),i.set(e,o),t.bytes=i,!t._ht){if(G(i,r),N(i,r),!F(G(i,r),[24,83,128,103]))return;for(G(i,r);r[0]<i.length;){var s=G(i,r),c=N(i,r),f=[0],u=0;if(!c)return;if(F(s,[22,84,174,107])){for(;f[0]<c.length;){var l=G(c,f),p=N(c,f),h=[0],d={channels:0,sampleRate:0};if(F(l,[174]))for(;h[0]<p.length;){var g=G(p,h),m=N(p,h),b=[0];if(F(g,[215])){var C=E(m);d.number=C,n[C]=d}else if(F(g,[131])){C=E(m);1==C?d.type="video":2==C?(d.type="audio",u||(t.track0=d),d.idx=u++):d.type="Type-"+C}else if(F(g,[134])){for(var _="",w=0;w<m.length;w++)_+=String.fromCharCode(m[w]);d.codec=_}else if(F(g,[225]))for(;b[0]<m.length;){var y=G(m,b),S=N(m,b);if(F(y,[181])){C=0;var x=new Uint8Array(S.reverse()).buffer;4==S.length?C=new Float32Array(x)[0]:8==S.length?C=new Float64Array(x)[0]:A("WebM Track !Float",1,S),d[v]=Math.round(C)}else F(y,[98,100])?d.bitDepth=E(S):F(y,[159])&&(d.channels=E(S))}}}t._ht=1,A("WebM Tracks",n),a();break}}}var M=t.track0;if(M){var k=M[v];if(t.webmSR=k,16==M.bitDepth&&/FLOAT/i.test(M.codec)&&(M.bitDepth=32,A("WebM 16->32 bit",3)),k<8e3||32!=M.bitDepth||M.channels<1||!/(\b|_)PCM\b/i.test(M.codec))return t.bytes=[],t.bad||A("WebM Track Unexpected",3,t),-(t.bad=1);for(var I=[],L=0;r[0]<i.length;){l=G(i,r),p=N(i,r);if(!p)break;if(F(l,[163])){var T=15&p[0];d=n[T];if(!d)return A("WebM !Track"+T,1,n),-1;if(0===d.idx){var R=new Uint8Array(p.length-4);for(w=4;w<p.length;w++)R[w-4]=p[w];I.push(R),L+=R.length}}a()}if(L){var O=new Uint8Array(i.length-t.pos[0]);O.set(i.subarray(t.pos[0])),t.bytes=O,t.pos[0]=0;R=new Uint8Array(L),w=0;for(var D=0;w<I.length;w++)R.set(I[w],D),D+=I[w].length;x=new Float32Array(R.buffer);if(1<M.channels){var z=[];for(w=0;w<x.length;)z.push(x[w]),w+=M.channels;x=new Float32Array(z)}return x}}},F=function(e,t){if(!e||e.length!=t.length)return!1;if(1==e.length)return e[0]==t[0];for(var n=0;n<e.length;n++)if(e[n]!=t[n])return!1;return!0},E=function(e){for(var t="",n=0;n<e.length;n++){var r=e[n];t+=(r<16?"0":"")+r.toString(16)}return parseInt(t,16)||0},G=function(e,t,n){var r=t[0];if(!(r>=e.length)){var a=e[r],o=("0000000"+a.toString(2)).substr(-8),i=/^(0*1)(\d*)$/.exec(o);if(i){var s=i[1].length,c=[];if(!(r+s>e.length)){for(var f=0;f<s;f++)c[f]=e[r],r++;return n&&(c[0]=parseInt(i[2]||"0",2)),t[0]=r,c}}}},N=function(e,t){var n=G(e,t,1);if(n){var r=E(n),a=t[0],o=[];if(r<2147483647){if(a+r>e.length)return;for(var i=0;i<r;i++)o[i]=e[a],a++}return t[0]=a,o}},U=i.i18n={lang:"zh-CN",alias:{"zh-CN":"zh","en-US":"en"},locales:{},data:{},put:function(e,t){var n=f+".i18n.put: ",r=e.overwrite;r=null==r||r;var a=e.lang;if(!(a=U.alias[a]||a))throw new Error(n+"set.lang?");var o=U.locales[a];o||(o={},U.locales[a]=o);for(var i,s=/^([\w\-]+):/,c=0;c<t.length;c++){var u=t[c];if(i=s.exec(u)){var l=i[1];u=u.substr(l.length+1);!r&&o[l]||(o[l]=u)}else A(n+"'key:'? "+u,3,e)}},get:function(){return U.v_G.apply(null,arguments)},v_G:function(e,t,n){t=t||[],n=n||U.lang,n=U.alias[n]||n;var r=U.locales[n],a=r&&r[e]||"";return a||"zh"==n?(U.lastLang=n,"=Empty"==a?"":a.replace(/\{(\d+)(\!?)\}/g,(function(n,r,o){return n=t[(r=+r||0)-1],(r<1||r>t.length)&&(n="{?}",A("i18n["+e+"] no {"+r+"}: "+a,3)),o?"":n}))):"en"==n?U.v_G(e,t,"zh"):U.v_G(e,t,"en")},$T:function(){return U.v_T.apply(null,arguments)},v_T:function(){for(var e,t=arguments,n="",a=[],o=0,i=f+".i18n.$T:",s=/^([\w\-]*):/,c=0;c<t.length;c++){var u=t[c];if(0==c){if(e=s.exec(u),!(n=e&&e[1]))throw new Error(i+"0 'key:'?");u=u.substr(n.length+1)}if(-1===o)a.push(u);else{if(o)throw new Error(i+" bad args");if(0===u)o=-1;else if(r(u)){if(u<1)throw new Error(i+" bad args");o=u}else{var l=1==c?"en":c?"":"zh";if((e=s.exec(u))&&(l=e[1]||l,u=u.substr(e[1].length+1)),!e||!l)throw new Error(i+c+" 'lang:'?");U.put({lang:l,overwrite:!1},[n+":"+u])}}}return n?0<o?n:U.v_G(n,a):""}},P=U.$T;P.G=U.get,P("NonBrowser-1::非浏览器环境，不支持{1}",1),P("IllegalArgs-1::参数错误：{1}",1),P("NeedImport-2::调用{1}需要先导入{2}",2),P("NotSupport-1::不支持：{1}",1),i.TrafficImgUrl="//ia.51.la/go1?id=20469973&pvFlag=1";var W=i.Traffic=function(e){if(t){e=e?"/"+f+"/Report/"+e:"";var n=i.TrafficImgUrl;if(n){var r=i.Traffic,a=/^(https?:..[^\/#]*\/?)[^#]*/i.exec(location.href)||[],o=a[1]||"http://file/",s=(a[0]||o)+e;if(0==n.indexOf("//")&&(n=/^https:/i.test(s)?"https:"+n:"http:"+n),e&&(n=n+"&cu="+encodeURIComponent(o+e)),!r[s]){r[s]=1;var c=new Image;c.src=n,A("Traffic Analysis Image: "+(e||f+".TrafficImgUrl="+i.TrafficImgUrl))}}}};d&&(A(P("8HO5::覆盖导入{1}",0,f),1),d.Destroy()),e[f]=i}(s,i),r=function(){return s.Recorder}.call(t,n,t,e),void 0!==r&&(e.exports=r),"object"==a(e)&&e.exports&&(e.exports=s.Recorder)}(),function(e){var t="object"==("undefined"===typeof window?"undefined":a(window))&&!!window.document,n=(t?window:Object).Recorder,r=n.i18n;!function(e,t,n,r){"use strict";e.prototype.enc_wav={stable:!0,fast:!0,getTestMsg:function(){return n("gPSE::支持位数8位、16位（填在比特率里面），采样率取值无限制；此编码器仅在pcm数据前加了一个44字节的wav头，编码出来的16位wav文件去掉开头的44字节即可得到pcm（注：其他wav编码器可能不是44字节）")}},e.prototype.wav=function(t,r,a){var o=this.set;!function(t){var r=t.bitRate,a=8==r?8:16;r!=a&&e.CLog(n("wyw9::WAV Info: 不支持{1}位，已更新成{2}位",0,r,a),3),t.bitRate=a}(o);var i=t.length,s=o.sampleRate,c=o.bitRate,f=i*(c/8),u=e.wav_header(1,1,s,c,f),l=u.length,v=new Uint8Array(l+f);if(v.set(u),8==c)for(var p=0;p<i;p++){var h=128+(t[p]>>8);v[l++]=h}else(v=new Int16Array(v.buffer)).set(t,l/2);r(v.buffer,"audio/wav")},e.wav_header=function(e,t,n,r,a){var o=1==e?0:2,i=new ArrayBuffer(44+o),s=new DataView(i),c=0,f=function(e){for(var t=0;t<e.length;t++,c++)s.setUint8(c,e.charCodeAt(t))},u=function(e){s.setUint16(c,e,!0),c+=2},l=function(e){s.setUint32(c,e,!0),c+=4};return f("RIFF"),l(36+o+a),f("WAVE"),f("fmt "),l(16+o),u(e),u(t),l(n),l(n*(t*r/8)),u(t*r/8),u(r),1!=e&&u(0),f("data"),l(a),new Uint8Array(i)}}(n,0,r.$T)}()}).call(this,n("dc84")(e))},"4f9b":function(e,t,n){"use strict";var r=n("6a50");r("Float32",(function(e){return function(t,n,r){return e(this,t,n,r)}}))},"825c":function(e,t,n){"use strict";var r=n("6a50");r("Float64",(function(e){return function(t,n,r){return e(this,t,n,r)}}))},c02e:function(e,t,n){"use strict";var r=n("6a50");r("Int32",(function(e){return function(t,n,r){return e(this,t,n,r)}}))}}]);