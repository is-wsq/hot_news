(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-template-recorder"],{"0b46":function(e,t,n){"use strict";var r=n("6a50");r("Int8",(function(e){return function(t,n,r){return e(this,t,n,r)}}))},"0e66":function(e,t,n){"use strict";n.r(t);var r=n("5d97"),a=n.n(r);for(var o in r)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(o);t["default"]=a.a},"1bf6":function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){}));var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-uni-view",{staticClass:"container"},[n("v-uni-button",{on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.startRecording.apply(void 0,arguments)}}},[e._v("开始录音")]),n("v-uni-button",{on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.stopRecording.apply(void 0,arguments)}}},[e._v("停止")]),e.audioUrl?n("v-uni-audio",{attrs:{src:e.audioUrl,controls:!0}}):e._e(),n("v-uni-button",{on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.handlerUpload.apply(void 0,arguments)}}},[e._v("上传")])],1)},a=[]},"20f3":function(e,t,n){"use strict";var r=n("8bdb"),a=n("5145");r({target:"Array",proto:!0,forced:a!==[].lastIndexOf},{lastIndexOf:a})},"2d48":function(e,t,n){"use strict";var r=n("6a50");r("Int16",(function(e){return function(t,n,r){return e(this,t,n,r)}}))},"4f9b":function(e,t,n){"use strict";var r=n("6a50");r("Float32",(function(e){return function(t,n,r){return e(this,t,n,r)}}))},"5d97":function(e,t,n){"use strict";n("6a54");var r=n("f5bd").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,n("c9b5"),n("bf0f"),n("ab80"),n("c223"),n("20f3"),n("18f7"),n("de6c"),n("dc89"),n("2425");var a=r(n("bb07")),o="Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJodHRwczovL2xpdmUudGVsbGFpLnRlY2giLCJzdWIiOiI3ODNjNGI1NC1hMWQwLTVmY2ItOTExZC1kNWM1YjNjODY2MTAiLCJpYXQiOjE3NDIyMTA0NDQsImV4cCI6MTc1OTc5NTIwMCwibmFtZSI6InRlc3QifQ.OGrW6VfdM7zLVcGjGz9UHblQQlQoHWSriFB90kJOq98",i={data:function(){return{recorder:null,audioUrl:""}},methods:{generateUniqueId:function(){return Date.now()+Math.random().toString(36).substr(2,16)},handlerUpload:function(){var e=this,t=this;uni.request({url:"https://live.tellai.tech/api/media/files/upload_request?type=audio",header:{Authorization:o},success:function(n){var r=n.data.base_resp,a=n.data.data;if(200===r.status_code){var i={name:"录制.wav",type:"voice",id:t.generateUniqueId()};t.$store.dispatch("task/addTask",i),t.$tip.confirm("已创建音色克隆任务\n《录制.wav》",!1).then((function(e){uni.redirectTo({url:"/pages/template/voice"})})),uni.uploadFile({url:"https://u480621-ba45-4d5fd016.westc.gpuhub.com:8443/files/upload_file",file:e.file,name:"file",header:{Authorization:o},timeout:18e5,formData:{file_id:a.file_id,type:"audio"},success:function(e){var n=JSON.parse(e.data).base_resp,r=JSON.parse(e.data).data;200===n.status_code?t.clone(r.file_id,i):(t.$store.dispatch("task/removeTask",i.id),t.$tip.confirm("".concat(i.name,"音色克隆任务失败,").concat(n.status_msg),!1))}})}else e.$tip.confirm(r.status_msg,!1)}})},clone:function(e,t){var n=this,r={file_id:e,user_id:uni.getStorageSync("userId"),audio_name:t.name.substring(0,t.name.lastIndexOf("."))};this.$http.post("/timbres/clone/file_id",r).then((function(e){n.$store.dispatch("task/removeTask",t.id),"success"===e.status?n.$tip.confirm("".concat(t.name,"音色克隆任务成功"),!1):n.$tip.confirm("".concat(t.name,"音色克隆任务失败,").concat(e.message),!1)}))},startRecording:function(){var e=this;a.default?(this.recorder=(0,a.default)({type:"wav",sampleRate:16e3,bitRate:16}),this.recorder.open((function(){e.recorder.start(),uni.showToast({title:"录音中...",icon:"none"})}),(function(e,t){console.error("录音授权失败:",e),uni.showToast({title:"录音失败",icon:"none"})}))):uni.showToast({title:"录音库未加载",icon:"none"})},stopRecording:function(){var e=this;this.recorder&&this.recorder.stop((function(t,n){e.audioUrl=URL.createObjectURL(t),e.file=new File([t],"recording.wav",{type:"audio/wav"}),console.log(e.file)}),(function(e){console.error("停止失败:",e),uni.showToast({title:"停止失败",icon:"none"})}))}}};t.default=i},"5f7c":function(e,t,n){var r=n("c86c");t=r(!1),t.push([e.i,".container[data-v-7126a900]{padding:%?40?%}uni-button[data-v-7126a900]{display:block;margin:%?20?% auto;width:%?200?%;height:%?80?%;line-height:%?80?%;text-align:center;background-color:#007aff;color:#fff;border-radius:%?10?%}",""]),e.exports=t},"825c":function(e,t,n){"use strict";var r=n("6a50");r("Float64",(function(e){return function(t,n,r){return e(this,t,n,r)}}))},bb07:function(e,t,n){(function(e){var r,a=n("bdbb").default;n("d4b5"),n("aa9c"),n("dd2b"),n("4db2"),n("bf0f"),n("2d48"),n("4d8f"),n("7b97"),n("668a"),n("c5b7"),n("8ff5"),n("2378"),n("641a"),n("64e0"),n("cce3"),n("efba"),n("d009"),n("bd7d"),n("7edd"),n("d798"),n("f547"),n("5e54"),n("b60a"),n("8c18"),n("12973"),n("f991"),n("198e"),n("8557"),n("63b1"),n("1954"),n("1cf1"),n("5c47"),n("a1c1"),n("c9b5"),n("ab80"),n("4f9b"),n("f7a5"),n("d5c6"),n("5a56"),n("f074"),n("c976"),n("8f71"),n("0506"),n("0b46"),n("c02e"),n("80e3"),n("dc69"),n("825c"),n("e966"),n("7a76"),n("5ef2"),function(o){var i="object"==("undefined"===typeof window?"undefined":a(window))&&!!window.document,s=i?window:Object;(function(e,t){"use strict";var n=function(){},r=function(e){return"number"==typeof e},o=function(e){return JSON.stringify(e)},i=function(e){return new k(e)},s=i.LM="2025-01-11 09:28",c="https://github.com/xiangyuecn/Recorder",u="Recorder",f=e[u];if(f&&f.LM==s)return void f.CLog(f.i18n.$T("K8zP::重复导入{1}",0,u),3);i.IsOpen=function(){var e=i.Stream;if(e){var t=y(e),n=t[0];if(n){var r=n.readyState;return"live"==r||r==n.LIVE}}return!1},i.BufferSize=4096,i.Destroy=function(){for(var e in S(u+" Destroy"),C(),l)l[e]()};var l={};i.BindDestroy=function(e,t){l[e]=t},i.Support=function(){if(!t)return!1;var e=navigator.mediaDevices||{};return e["getUserMedia"]||(e=navigator,e["getUserMedia"]||(e["getUserMedia"]=e.webkitGetUserMedia||e.mozGetUserMedia||e.msGetUserMedia)),!!e["getUserMedia"]&&(i.Scope=e,!!i.GetContext())},i.GetContext=function(e){if(!t)return null;var n=window.AudioContext;if(n||(n=window.webkitAudioContext),!n)return null;var r=i.Ctx,a=0;return r||(r=i.Ctx=new n,a=1,i.NewCtxs=i.NewCtxs||[],i.BindDestroy("Ctx",(function(){var e=i.Ctx;e&&e.close&&(d(e),i.Ctx=0);var t=i.NewCtxs;i.NewCtxs=[];for(var n=0;n<t.length;n++)d(t[n])}))),e&&r.close&&(a||(r._useC||d(r),r=new n),r._useC=1,i.NewCtxs.push(r)),r},i.CloseNewCtx=function(e){if(e&&e.close){d(e);for(var t=i.NewCtxs||[],n=t.length,r=0;r<t.length;r++)if(t[r]==e){t.splice(r,1);break}S(U("mSxV::剩{1}个GetContext未close",0,n+"-1="+t.length),t.length?3:0)}};var d=function(e){if(e&&e.close&&!e._isC&&(e._isC=1,"closed"!=e.state))try{e.close()}catch(t){S("ctx close err",1,t)}},h=i.ResumeCtx=function(e,t,n,r){var a=0,o=0,i=0,s=0,c="EventListener",u="ResumeCtx ",f=function(t,u){o&&l(),a||(a=1,t&&r(t,s),u&&n(s)),u&&(!e._LsSC&&e["add"+c]&&e["add"+c]("statechange",d),e._LsSC=1,i=1)},l=function(e){if(!e||!o){o=e?1:0;for(var t=["focus","mousedown","mouseup","touchstart","touchend"],n=0;n<t.length;n++)window[(e?"add":"remove")+c](t[n],d,!0)}},d=function(){var n=e.state,r=v(n);if(!a&&!t(r?++s:s))return f();r?(i&&S(u+"sc "+n,3),l(1),e.resume().then((function(){i&&S(u+"sc "+e.state),f(0,1)}))["catch"]((function(t){S(u+"error",1,t),v(e.state)||f(t.message||"error")}))):"closed"==n?(i&&!e._isC&&S(u+"sc "+n,1),f("ctx closed")):f(0,1)};d()},v=i.CtxSpEnd=function(e){return"suspended"==e||"interrupted"==e},p=function(e){var t=e.state,n="ctx.state="+t;return v(t)&&(n+=U("nMIy::（注意：ctx不是running状态，rec.open和start至少要有一个在用户操作(触摸、点击等)时进行调用，否则将在rec.start时尝试进行ctx.resume，可能会产生兼容性问题(仅iOS)，请参阅文档中runningContext配置）")),n};i["ConnectEnableWebM"]=!0;i["ConnectEnableWorklet"]=!1;var g=function(e){var t=e.BufferSize||i.BufferSize,n=e.Stream,r=n._c,a=r["sampleRate"],s={},c=y(n),f=c[0],l=null,d="";if(f&&f.getSettings){l=f.getSettings();var v=l["sampleRate"];v&&v!=a&&(d=U("eS8i::Stream的采样率{1}不等于{2}，将进行采样率转换（注意：音质不会变好甚至可能变差），主要在移动端未禁用回声消除时会产生此现象，浏览器有回声消除时可能只会返回16k采样率的音频数据，",0,v,a))}n._ts=l,S(d+"Stream TrackSet: "+o(l),d?3:0);var p,g,m,C=function(e){var t=n._m=r.createMediaStreamSource(n),a=r.destination,o="createMediaStreamDestination";r[o]&&(a=n._d=r[o]()),t.connect(e),e.connect(a)},w="",x=n._call,M=function(e,t){for(var n in x){if(t!=a){s.index=0,s=i.SampleData([e],t,a,s,{_sum:1});var r=s.data,o=s._sum}else{s={};for(var c=e.length,u=(r=new Int16Array(c),o=0,0);u<c;u++){var f=Math.max(-1,Math.min(1,e[u]));f=f<0?32768*f:32767*f,r[u]=f,o+=Math.abs(f)}}for(var l in x)x[l](r,o);return}},k=r.createScriptProcessor||r.createJavaScriptNode,I=U("ZGlf::。由于{1}内部1秒375次回调，在移动端可能会有性能问题导致回调丢失录音变短，PC端无影响，暂不建议开启{1}。",0,"audioWorklet"),L=function(){g=n.isWorklet=!1,b(n),S(U("7TU0::Connect采用老的{1}，",0,"ScriptProcessor")+A.get(U(i["ConnectEnableWorklet"]?"JwCL::但已设置{1}尝试启用{2}":"VGjB::可设置{1}尝试启用{2}",2),[u+".ConnectEnableWorklet=true","audioWorklet"])+w+I,3);var e=n._p=k.call(r,t,1,1);C(e),e.onaudioprocess=function(e){var t=e.inputBuffer.getChannelData(0);M(t,a)}},T=function(){p=n.isWebM=!1,_(n),g=n.isWorklet=!k||i["ConnectEnableWorklet"];var e=window.AudioWorkletNode;if(g&&r["audioWorklet"]&&e){var o=function(){return g&&n._na},s=n._na=function(){""!==m&&(clearTimeout(m),m=setTimeout((function(){m=0,o()&&(S(U("MxX1::{1}未返回任何音频，恢复使用{2}",0,"audioWorklet","ScriptProcessor"),3),k&&L())}),500))},c=function(){if(o()){var i=n._n=new e(r,"RecProc",{processorOptions:{bufferSize:t}});C(i),i.port.onmessage=function(e){m&&(clearTimeout(m),m=""),o()?M(e.data.val,a):g||S(U("XUap::{1}多余回调",0,"audioWorklet"),3)},S(U("yOta::Connect采用{1}，设置{2}可恢复老式{3}",0,"audioWorklet",u+".ConnectEnableWorklet=false","ScriptProcessor")+w+I,3)}},f=function(){if(o())if(r["RecProc"])c();else{var e=function(){var e=function(e){return e.toString().replace(/^function|DEL_/g,"").replace(/\$RA/g,"Recorder audioWorklet")},t="class RecProc extends AudioWorkletProcessor{";return t+="constructor "+e((function(e){DEL_super(e);var t=this,n=e.processorOptions.bufferSize;t.bufferSize=n,t.buffer=new Float32Array(2*n),t.pos=0,t.port.onmessage=function(e){e.data.kill&&(t.kill=!0,$C.log("$RA kill call"))},$C.log("$RA .ctor call",e)})),t+="process "+e((function(e,t,n){var r=this.bufferSize,a=this.buffer,o=this.pos;if(e=(e[0]||[])[0]||[],e.length){a.set(e,o),o+=e.length;var i=~~(o/r)*r;if(i){this.port.postMessage({val:a.slice(0,i)});var s=a.subarray(i,o);a=new Float32Array(2*r),a.set(s),o=s.length,this.buffer=a}this.pos=o}return!this.kill})),t+='}try{registerProcessor("RecProc", RecProc)}catch(e){$C.error("Recorder audioWorklet Reg Error",e)}',t=t.replace(/\$C\./g,"console."),"data:text/javascript;base64,"+btoa(unescape(encodeURIComponent(t)))}();r["audioWorklet"].addModule(e).then((function(e){o()&&(r["RecProc"]=1,c(),m&&s())}))["catch"]((function(e){S("audioWorklet.addModule Error",1,e),o()&&L()}))}};h(r,(function(){return o()}),f,f)}else L()};(function(){var e=window["MediaRecorder"];p=n.isWebM=i["ConnectEnableWebM"];var r=e&&"ondataavailable"in e.prototype&&e.isTypeSupported("audio/webm; codecs=pcm");if(w=r?"":U("VwPd::（此浏览器不支持{1}）",0,"MediaRecorder.WebM.PCM"),p&&r){var a=function(){return p&&n._ra};n._ra=function(){""!==m&&(clearTimeout(m),m=setTimeout((function(){a()&&(S(U("vHnb::{1}未返回任何音频，降级使用{2}",0,"MediaRecorder","audioWorklet"),3),T())}),500))};var o=Object.assign({mimeType:"audio/webm; codecs=pcm"},i.ConnectWebMOptions),s=n._r=new e(n,o),c=n._rd={};s["ondataavailable"]=function(e){var t=new FileReader;t.onloadend=function(){if(a()){var e=R(new Uint8Array(t.result),c);if(!e)return;if(-1==e)return void T();m&&(clearTimeout(m),m=""),M(e,c.webmSR)}else p||S(U("O9P7::{1}多余回调",0,"MediaRecorder"),3)},t.readAsArrayBuffer(e.data)};try{s.start(~~(t/48)),S(U("LMEm::Connect采用{1}，设置{2}可恢复使用{3}或老式{4}",0,"MediaRecorder.WebM.PCM",u+".ConnectEnableWebM=false","audioWorklet","ScriptProcessor"))}catch(f){S("mr start err",1,f),T()}}else T()})()},m=function(e){e._na&&e._na(),e._ra&&e._ra()},b=function(e){e._na=null,e._n&&(e._n.port.postMessage({kill:!0}),e._n.disconnect(),e._n=null)},_=function(e){if(e._ra=null,e._r){try{e._r.stop()}catch(t){S("mr stop err",1,t)}e._r=null}},C=function(e){e=e||i;var t=e==i,n=e.Stream;n&&(n._m&&(n._m.disconnect(),n._m=null),!n._RC&&n._c&&i.CloseNewCtx(n._c),n._RC=null,n._c=null,n._d&&(w(n._d.stream),n._d=null),n._p&&(n._p.disconnect(),n._p.onaudioprocess=n._p=null),b(n),_(n),t&&w(n)),e.Stream=0},w=i.StopS_=function(e){for(var t=y(e),n=0;n<t.length;n++){var r=t[n];r.stop&&r.stop()}e.stop&&e.stop()},y=function(e){var t=0,n=0,r=[];e.getAudioTracks&&(t=e.getAudioTracks(),n=e.getVideoTracks()),t||(t=e.audioTracks,n=e.videoTracks);for(var a=0,o=t?t.length:0;a<o;a++)r.push(t[a]);for(a=0,o=n?n.length:0;a<o;a++)r.push(n[a]);return r};i.SampleData=function(e,t,n,r,a){var o="SampleData";r||(r={});var s=r.index||0,c=r.offset||0,u=r.raisePrev||0,f=r.filter;if(f&&f.fn&&(f.sr&&f.sr!=t||f.srn&&f.srn!=n)&&(f=null,S(U("d48C::{1}的filter采样率变了，重设滤波",0,o),3)),!f)if(n<=t){var l=n>3*t/4?0:n/2*3/4;f={fn:l?i.IIRFilter(!0,t,l):0}}else{l=t>3*n/4?0:t/2*3/4;f={fn:l?i.IIRFilter(!0,n,l):0}}f.sr=t,f.srn=n;var d=f.fn,h=r.frameNext||[];a||(a={});var v=a.frameSize||1;a.frameType&&(v="mp3"==a.frameType?1152:1);var p=a._sum,g=0,m=e.length;s>m+1&&S(U("tlbC::{1}似乎传入了未重置chunk {2}",0,o,s+">"+m),3);for(var b=0,_=s;_<m;_++)b+=e[_].length;var C=t/n;if(C>1)b=Math.max(0,b-Math.floor(c)),b=Math.floor(b/C);else if(C<1){var w=1/C;b=Math.floor(b*w)}b+=h.length;var y=new Int16Array(b),x=0;for(_=0;_<h.length;_++)y[x]=h[_],x++;for(;s<m;s++){var M=e[s],k=M instanceof Float32Array,R=(_=c,M.length),I=d&&d.Embed,L=0,T=0,O=0,A=0;if(C<1){for(var W=x+_,E=u,N=0;N<R;N++){var z=M[N];k&&(z=Math.max(-1,Math.min(1,z)),z=z<0?32768*z:32767*z);var D=Math.floor(W);W+=w;for(var G=Math.floor(W),F=(z-E)/(G-D),P=1;D<G;D++,P++){var $=Math.floor(E+P*F);I?(O=$,A=I.b0*O+I.b1*I.x1+I.b0*I.x2-I.a1*I.y1-I.a2*I.y2,I.x2=I.x1,I.x1=O,I.y2=I.y1,I.y1=A,$=A):$=d?d($):$,$>32767?$=32767:$<-32768&&($=-32768),p&&(g+=Math.abs($)),y[D]=$,x++}E=u=z,_+=w}c=_%1}else{N=0;for(var B=0;N<R;N++,B++){if(B<R){z=M[B];k&&(z=Math.max(-1,Math.min(1,z)),z=z<0?32768*z:32767*z),I?(O=z,A=I.b0*O+I.b1*I.x1+I.b0*I.x2-I.a1*I.y1-I.a2*I.y2,I.x2=I.x1,I.x1=O,I.y2=I.y1,I.y1=A):A=d?d(z):z}if(L=T,T=A,0!=B){var J=Math.floor(_);if(N==J){var j=Math.ceil(_),V=_-J,Q=L,H=j<R?T:Q,q=Q+(H-Q)*V;q>32767?q=32767:q<-32768&&(q=-32768),p&&(g+=Math.abs(q)),y[x]=q,x++,_+=C}}else N--}c=Math.max(0,_-R)}}C<1&&x+1==b&&(b--,y=new Int16Array(y.buffer.slice(0,2*b))),x-1!=b&&x!=b&&S(o+" idx:"+x+" != size:"+b,3),h=null;var X=b%v;if(X>0){var Y=2*(b-X);h=new Int16Array(y.buffer.slice(Y)),y=new Int16Array(y.buffer.slice(0,Y))}var K={index:s,offset:c,raisePrev:u,filter:f,frameNext:h,sampleRate:n,data:y};return p&&(K._sum=g),K},i.IIRFilter=function(e,t,n){var r=2*Math.PI*n/t,a=Math.sin(r),o=Math.cos(r),i=a/2,s=1+i,c=-2*o/s,u=(1-i)/s;if(e)var f=(1-o)/2/s,l=(1-o)/s;else f=(1+o)/2/s,l=-(1+o)/s;var d=0,h=0,v=0,p=0,g=0,m=function(e){return v=f*e+l*d+f*h-c*p-u*g,h=d,d=e,g=p,p=v,v};return m.Embed={x1:0,x2:0,y1:0,y2:0,b0:f,b1:l,a1:c,a2:u},m},i.PowerLevel=function(e,t){var n,r=e/t||0;return n=r<1251?Math.round(r/1250*10):Math.round(Math.min(100,Math.max(0,100*(1+Math.log(r/1e4)/Math.log(10))))),n},i.PowerDBFS=function(e){var t=Math.max(.1,e||0);return t=Math.min(t,32767),t=20*Math.log(t/32767)/Math.log(10),Math.max(-100,Math.round(t))},i.CLog=function(e,t){if("object"==("undefined"===typeof console?"undefined":a(console))){var n=new Date,o=("0"+n.getMinutes()).substr(-2)+":"+("0"+n.getSeconds()).substr(-2)+"."+("00"+n.getMilliseconds()).substr(-3),s=this&&this.envIn&&this.envCheck&&this.id,c=["["+o+" "+u+(s?":"+s:"")+"]"+e],f=arguments,l=i.CLog,d=2,h=l.log||console.log;for(r(t)?h=1==t?l.error||console.error:3==t?l.warn||console.warn:h:d=1;d<f.length;d++)c.push(f[d]);x?h&&h("[IsLoser]"+c[0],c.length>1?c:""):h.apply(console,c)}};var S=function(){i.CLog.apply(this,arguments)},x=!0;try{x=!console.log.apply}catch(E){}var M=0;function k(e){this.id=++M,W();var t={type:"mp3",onProcess:n};for(var a in e)t[a]=e[a];this.set=t;var o=t["bitRate"],i=t["sampleRate"];(o&&!r(o)||i&&!r(i))&&this.CLog(U.G("IllegalArgs-1",[U("VtS4::{1}和{2}必须是数值",0,"sampleRate","bitRate")]),1,e),t["bitRate"]=+o||16,t["sampleRate"]=+i||16e3,this.state=0,this._S=9,this.Sync={O:9,C:9}}i.Sync={O:9,C:9},i.prototype=k.prototype={CLog:S,_streamStore:function(){return this.set.sourceStream?this:i},_streamGet:function(){return this._streamStore().Stream},_streamCtx:function(){var e=this._streamGet();return e&&e._c},open:function(e,r){var u=this,f=u.set,l=u._streamStore(),d=0;e=e||n;var h=function(e,t){t=!!t,u.CLog(U("5tWi::录音open失败：")+e+",isUserNotAllow:"+t,1),d&&i.CloseNewCtx(d),r&&r(e,t)};u._streamTag="getUserMedia";var v=function(){u.CLog("open ok, id:"+u.id+" stream:"+u._streamTag),e(),u._SO=0},m=l.Sync,b=++m.O,_=m.C;u._O=u._O_=b,u._SO=u._S;if(t){var w=u.envCheck({envName:"H5",canProcess:!0});if(w)h(U("A5bm::不能录音：")+w);else{var y,S=function(){y=f.runningContext,y||(y=d=i.GetContext(!0))};if(f.sourceStream){if(u._streamTag="set.sourceStream",!i.GetContext())return void h(U("1iU7::不支持此浏览器从流中获取录音"));S(),C(l);var x=u.Stream=f.sourceStream;x._c=y,x._RC=f.runningContext,x._call={};try{g(l)}catch(E){return C(l),void h(U("BTW2::从流中打开录音失败：")+E.message)}v()}else{var M=function(e,t){try{window.top.a}catch(E){return void h(U("Nclz::无权录音(跨域，请尝试给iframe添加麦克风访问策略，如{1})",0,'allow="camera;microphone"'))}k(1,e)&&(/Found/i.test(e)?h(t+U("jBa9::，无可用麦克风")):h(t))},k=function(e,t){if(/Permission|Allow/i.test(t))e&&h(U("gyO5::用户拒绝了录音权限"),!0);else{if(!1!==window.isSecureContext)return 1;e&&h(U("oWNo::浏览器禁止不安全页面录音，可开启https解决"))}};if(i.IsOpen())v();else if(i.Support()){S();var R,I,L=function(e){setTimeout((function(){e._call={};var t=i.Stream;t&&(C(),e._call=t._call),i.Stream=e,e._c=y,e._RC=f.runningContext,function(){if(_!=m.C||!u._O){var e=U("dFm8::open被取消");return b==m.O?u.close():e=U("VtJO::open被中断"),h(e),!0}}()||(i.IsOpen()?(t&&u.CLog(U("upb8::发现同时多次调用open"),1),g(l),v()):h(U("Q1GA::录音功能无效：无音频流")))}),100)},T=function(e){var t=e.name||e.message||e.code+":"+e,n="";1==O&&k(0,t)&&(n=U("KxE2::，将尝试禁用回声消除后重试"));var r=U("xEQR::请求录音权限错误"),a=U("bDOG::无法录音：");u.CLog(r+n+"|"+e,n||I?3:1,e),n?(R=t,I=e,A(1)):I?(u.CLog(r+"|"+I,1,I),M(R,a+I)):M(t,a+e)},O=0,A=function(e){O++;var t="audioTrackSet",n="echoCancellation",r="noiseSuppression",l=JSON.parse(o(f[t]||!0));u.CLog("open... "+O+" "+t+":"+o(l)),e&&("object"!=a(l)&&(l={}),l["autoGainControl"]=!1,l[n]=!1,l[r]=!1),l["sampleRate"]&&u.CLog(U("IjL3::注意：已配置{1}参数，可能会出现浏览器不能正确选用麦克风、移动端无法启用回声消除等现象",0,t+".sampleRate"),3);var d={audio:l,video:f.videoTrackSet||!1};try{var h=i.Scope["getUserMedia"](d,L,T)}catch(E){u.CLog("getUserMedia",3,E),d={audio:!0,video:!1},h=i.Scope["getUserMedia"](d,L,T)}u.CLog("getUserMedia("+o(d)+") "+p(y)+U("RiWe::，未配置 {1} 时浏览器可能会自动启用回声消除，移动端未禁用回声消除时可能会降低系统播放音量（关闭录音后可恢复）和仅提供16k采样率的音频流（不需要回声消除时可明确配置成禁用来获得48k高音质的流），请参阅文档中{2}配置",0,"audioTrackSet:{echoCancellation,noiseSuppression,autoGainControl}",t)+"("+c+") LM:"+s+" UA:"+navigator.userAgent),h&&h.then&&h.then(L)["catch"](T)};A()}else M("",U("COxc::此浏览器不支持录音"))}}}else h(U.G("NonBrowser-1",["open"])+U("EMJq::，可尝试使用RecordApp解决方案")+"("+c+"/tree/master/app-support-sample)")},close:function(e){e=e||n;var t=this._streamStore();this._stop();var r=" stream:"+this._streamTag,a=t.Sync;if(this._O=0,this._O_!=a.O)return this.CLog(U("hWVz::close被忽略（因为同时open了多个rec，只有最后一个会真正close）")+r,3),void e();a.C++,C(t),this.CLog("close,"+r),e()},mock:function(e,t){return this._stop(),this.isMock=1,this.mockEnvInfo=null,this.buffers=[e],this.recSize=e.length,this._setSrcSR(t),this._streamTag="mock",this},_setSrcSR:function(e){var t=this.set,n=t["sampleRate"];n>e?t["sampleRate"]=e:n=0,this["srcSampleRate"]=e,this.CLog("srcSampleRate: "+e+" set.sampleRate: "+t["sampleRate"]+(n?" "+U("UHvm::忽略")+": "+n:""),n?3:0)},envCheck:function(e){var t,n=this.set,r="CPU_BE";if(t||i[r]||"function"!=typeof Int8Array||new Int8Array(new Int32Array([1]).buffer)[0]||(W(r),t=U("Essp::不支持{1}架构",0,r)),!t){var a=n.type,o=this[a+"_envCheck"];n.takeoffEncodeChunk&&(o?e.canProcess||(t=U("7uMV::{1}环境不支持实时处理",0,e.envName)):t=U("2XBl::{1}类型不支持设置takeoffEncodeChunk",0,a)+(this[a]?"":U("LG7e::(未加载编码器)"))),!t&&o&&(t=this[a+"_envCheck"](e,n))}return t||""},envStart:function(e,t){var n=this.set;if(this.isMock=e?1:0,this.mockEnvInfo=e,this.buffers=[],this.recSize=0,e&&(this._streamTag="env$"+e.envName),this.state=1,this.envInLast=0,this.envInFirst=0,this.envInFix=0,this.envInFixTs=[],this._setSrcSR(t),this.engineCtx=0,this[n.type+"_start"]){var r=this.engineCtx=this[n.type+"_start"](n);r&&(r.pcmDatas=[],r.pcmSize=0)}},envResume:function(){this.envInFixTs=[]},envIn:function(e,t){var n=this,r=n.set,a=n.engineCtx;if(1==n.state){var o=n["srcSampleRate"],s=e.length,c=i.PowerLevel(t,s),u=n.buffers,f=u.length;u.push(e);var l=u,d=f,h=Date.now(),v=Math.round(s/o*1e3);n.envInLast=h,1==n.buffers.length&&(n.envInFirst=h-v);var p=n.envInFixTs;p.splice(0,0,{t:h,d:v});for(var g=h,m=0,b=0;b<p.length;b++){var _=p[b];if(h-_.t>3e3){p.length=b;break}g=_.t,m+=_.d}var C=p[1],w=h-g,y=w-m;if(y>w/3&&(C&&w>1e3||p.length>=6)){var S=h-C.t-v;if(S>v/5){var x=!r.disableEnvInFix;if(n.CLog("["+h+"]"+A.get(U(x?"4Kfd::补偿{1}ms":"bM5i::未补偿{1}ms",1),[S]),3),n.envInFix+=S,x){var M=new Int16Array(S*o/1e3);s+=M.length,u.push(M)}}}var k=n.recSize,R=s,I=k+R;if(n.recSize=I,a){var L=i.SampleData(u,o,r["sampleRate"],a.chunkInfo);a.chunkInfo=L,k=a.pcmSize,R=L.data.length,I=k+R,a.pcmSize=I,u=a.pcmDatas,f=u.length,u.push(L.data),o=L["sampleRate"]}var T=Math.round(I/o*1e3),O=u.length,W=l.length,N=function(){for(var e=z?0:-R,t=null==u[0],o=f;o<O;o++){var i=u[o];null==i?t=1:(e+=i.length,a&&i.length&&n[r.type+"_encode"](a,i))}if(t&&a){o=d;for(l[0]&&(o=0);o<W;o++)l[o]=null}t&&(e=z?R:0,u[0]=null),a?a.pcmSize+=e:n.recSize+=e},z=0;try{z=r.onProcess(u,c,T,o,f,N),z=!0===z}catch(E){console.error("rec.set.onProcess"+U("gFUF::回调出错是不允许的，需保证不会抛异常"),E)}var D=Date.now()-h;if(D>10&&n.envInFirst-h>1e3&&n.CLog("rec.set.onProcess"+U("2ghS::低性能，耗时{1}ms",0,D),3),z){var G=0;for(b=f;b<O;b++)null==u[b]?G=1:u[b]=new Int16Array(0);G?n.CLog(U("ufqH::未进入异步前不能清除buffers"),3):a?a.pcmSize-=R:n.recSize-=R}else N()}else n.state||n.CLog("envIn at state=0",3)},start:function(){var e=this,t=1;if(e.set.sourceStream?e.Stream||(t=0):i.IsOpen()||(t=0),t){var n=e._streamCtx();if(e.CLog(U("kLDN::start 开始录音，")+p(n)+" stream:"+e._streamTag),e._stop(),e.envStart(null,n["sampleRate"]),e.state=3,e._SO&&e._SO+1!=e._S)e.CLog(U("Bp2y::start被中断"),3);else{e._SO=0;var r=function(){3==e.state&&(e.state=1,e.resume())},a="AudioContext resume: ",o=e._streamGet();o._call[e.id]=function(){e.CLog(a+n.state+"|stream ok"),r()},h(n,(function(t){return t&&e.CLog(a+"wait..."),3==e.state}),(function(t){t&&e.CLog(a+n.state),r()}),(function(t){e.CLog(a+n.state+U("upkE::，可能无法录音：")+t,1),r()}))}}else e.CLog(U("6WmN::start失败：未open"),1)},pause:function(){var e=this._streamGet();this.state&&(this.state=2,this.CLog("pause"),e&&delete e._call[this.id])},resume:function(){var e=this,t=e._streamGet(),n="resume(wait ctx)";if(3==e.state)e.CLog(n);else if(e.state){e.state=1,e.CLog("resume"),e.envResume(),t&&(t._call[e.id]=function(t,n){1==e.state&&e.envIn(t,n)},m(t));var r=e._streamCtx();r&&h(r,(function(t){return t&&e.CLog(n+"..."),1==e.state}),(function(a){a&&e.CLog(n+r.state),m(t)}),(function(t){e.CLog(n+r.state+"[err]"+t,1)}))}},_stop:function(e){var t=this.set;this.isMock||this._S++,this.state&&(this.pause(),this.state=0),!e&&this[t.type+"_stop"]&&(this[t.type+"_stop"](this.engineCtx),this.engineCtx=0)},stop:function(e,t,n){var r,a=this,o=a.set,f=a.envInLast-a.envInFirst,l=f&&a.buffers.length;a.CLog(U("Xq4s::stop 和start时差:")+(f?f+"ms "+U("3CQP::补偿:")+a.envInFix+"ms envIn:"+l+" fps:"+(l/f*1e3).toFixed(1):"-")+" stream:"+a._streamTag+" ("+c+") LM:"+s);var d=function(){a._stop(),n&&a.close()},h=function(e){a.CLog(U("u8JG::结束录音失败：")+e,1),t&&t(e),d()},v=function(t,n,s){var c="DefaultDataType",f=a["dataType"]||i[c]||"blob",l="dataType="+f,v=t instanceof ArrayBuffer,p=0,g=v?t.byteLength:t.size;if("arraybuffer"==f?v||(p=1):"blob"==f?"function"!=typeof Blob?p=U.G("NonBrowser-1",[l])+U("1skY::，请设置{1}",0,u+"."+c+'="arraybuffer"'):(v&&(t=new Blob([t],{type:n})),t instanceof Blob||(p=1),n=t.type||n):p=U.G("NotSupport-1",[l]),a.CLog(U("Wv7l::结束录音 编码花{1}ms 音频时长{2}ms 文件大小{3}b",0,Date.now()-r,s,g)+" "+l+","+n),p)h(1!=p?p:U("Vkbd::{1}编码器返回的不是{2}",0,o.type,f)+", "+l);else{if(o.takeoffEncodeChunk)a.CLog(U("QWnr::启用takeoffEncodeChunk后stop返回的blob长度为0不提供音频数据"),3);else if(g<Math.max(50,s/5))return void h(U("Sz2H::生成的{1}无效",0,o.type));e&&e(t,s,n),d()}};if(!a.isMock){var p=3==a.state;if(!a.state||p)return void h(U("wf9t::未开始录音")+(p?U("Dl2c::，开始录音前无用户交互导致AudioContext未运行"):""))}a._stop(!0);var g=a.recSize;if(g)if(a[o.type]){if(a.isMock){var m=a.envCheck(a.mockEnvInfo||{envName:"mock",canProcess:!1});if(m)return void h(U("AxOH::录音错误：")+m)}var b=a.engineCtx;if(a[o.type+"_complete"]&&b){var _=Math.round(b.pcmSize/o["sampleRate"]*1e3);return r=Date.now(),void a[o.type+"_complete"](b,(function(e,t){v(e,t,_)}),h)}if(r=Date.now(),a.buffers[0]){var C=i.SampleData(a.buffers,a["srcSampleRate"],o["sampleRate"]);o["sampleRate"]=C["sampleRate"];var w=C.data;_=Math.round(w.length/o["sampleRate"]*1e3);a.CLog(U("CxeT::采样:{1} 花:{2}ms",0,g+"->"+w.length,Date.now()-r)),setTimeout((function(){r=Date.now(),a[o.type](w,(function(e,t){v(e,t,_)}),(function(e){h(e)}))}))}else h(U("xkKd::音频buffers被释放"))}else h(U("xGuI::未加载{1}编码器，请尝试到{2}的src/engine内找到{1}的编码器并加载",0,o.type,u));else h(U("Ltz3::未采集到录音"))}};var R=function(e,t){t.pos||(t.pos=[0],t.tracks={},t.bytes=[]);var n=t.tracks,r=[t.pos[0]],a=function(){t.pos[0]=r[0]},o=t.bytes.length,i=new Uint8Array(o+e.length);if(i.set(t.bytes),i.set(e,o),t.bytes=i,!t._ht){if(T(i,r),O(i,r),!I(T(i,r),[24,83,128,103]))return;T(i,r);while(r[0]<i.length){var s=T(i,r),c=O(i,r),u=[0],f=0;if(!c)return;if(I(s,[22,84,174,107])){while(u[0]<c.length){var l=T(c,u),d=O(c,u),h=[0],v={channels:0,sampleRate:0};if(I(l,[174]))while(h[0]<d.length){var p=T(d,h),g=O(d,h),m=[0];if(I(p,[215])){var b=L(g);v.number=b,n[b]=v}else if(I(p,[131])){b=L(g);1==b?v.type="video":2==b?(v.type="audio",f||(t.track0=v),v.idx=f++):v.type="Type-"+b}else if(I(p,[134])){for(var _="",C=0;C<g.length;C++)_+=String.fromCharCode(g[C]);v.codec=_}else if(I(p,[225]))while(m[0]<g.length){var w=T(g,m),y=O(g,m);if(I(w,[181])){b=0;var x=new Uint8Array(y.reverse()).buffer;4==y.length?b=new Float32Array(x)[0]:8==y.length?b=new Float64Array(x)[0]:S("WebM Track !Float",1,y),v["sampleRate"]=Math.round(b)}else I(w,[98,100])?v.bitDepth=L(y):I(w,[159])&&(v.channels=L(y))}}}t._ht=1,S("WebM Tracks",n),a();break}}}var M=t.track0;if(M){var k=M["sampleRate"];if(t.webmSR=k,16==M.bitDepth&&/FLOAT/i.test(M.codec)&&(M.bitDepth=32,S("WebM 16->32 bit",3)),k<8e3||32!=M.bitDepth||M.channels<1||!/(\b|_)PCM\b/i.test(M.codec))return t.bytes=[],t.bad||S("WebM Track Unexpected",3,t),t.bad=1,-1;var R=[],A=0;while(r[0]<i.length){l=T(i,r),d=O(i,r);if(!d)break;if(I(l,[163])){var U=15&d[0];v=n[U];if(!v)return S("WebM !Track"+U,1,n),-1;if(0===v.idx){var W=new Uint8Array(d.length-4);for(C=4;C<d.length;C++)W[C-4]=d[C];R.push(W),A+=W.length}}a()}if(A){var E=new Uint8Array(i.length-t.pos[0]);E.set(i.subarray(t.pos[0])),t.bytes=E,t.pos[0]=0;W=new Uint8Array(A),C=0;for(var N=0;C<R.length;C++)W.set(R[C],N),N+=R[C].length;x=new Float32Array(W.buffer);if(M.channels>1){var z=[];for(C=0;C<x.length;)z.push(x[C]),C+=M.channels;x=new Float32Array(z)}return x}}},I=function(e,t){if(!e||e.length!=t.length)return!1;if(1==e.length)return e[0]==t[0];for(var n=0;n<e.length;n++)if(e[n]!=t[n])return!1;return!0},L=function(e){for(var t="",n=0;n<e.length;n++){var r=e[n];t+=(r<16?"0":"")+r.toString(16)}return parseInt(t,16)||0},T=function(e,t,n){var r=t[0];if(!(r>=e.length)){var a=e[r],o=("0000000"+a.toString(2)).substr(-8),i=/^(0*1)(\d*)$/.exec(o);if(i){var s=i[1].length,c=[];if(!(r+s>e.length)){for(var u=0;u<s;u++)c[u]=e[r],r++;return n&&(c[0]=parseInt(i[2]||"0",2)),t[0]=r,c}}}},O=function(e,t){var n=T(e,t,1);if(n){var r=L(n),a=t[0],o=[];if(r<2147483647){if(a+r>e.length)return;for(var i=0;i<r;i++)o[i]=e[a],a++}return t[0]=a,o}},A=i.i18n={lang:"zh-CN",alias:{"zh-CN":"zh","en-US":"en"},locales:{},data:{},put:function(e,t){var n=u+".i18n.put: ",r=e.overwrite;r=null==r||r;var a=e.lang;if(a=A.alias[a]||a,!a)throw new Error(n+"set.lang?");var o=A.locales[a];o||(o={},A.locales[a]=o);for(var i,s=/^([\w\-]+):/,c=0;c<t.length;c++){var f=t[c];if(i=s.exec(f),i){var l=i[1];f=f.substr(l.length+1);!r&&o[l]||(o[l]=f)}else S(n+"'key:'? "+f,3,e)}},get:function(){return A.v_G.apply(null,arguments)},v_G:function(e,t,n){t=t||[],n=n||A.lang,n=A.alias[n]||n;var r=A.locales[n],a=r&&r[e]||"";return a||"zh"==n?(A.lastLang=n,"=Empty"==a?"":a.replace(/\{(\d+)(\!?)\}/g,(function(n,r,o){return r=+r||0,n=t[r-1],(r<1||r>t.length)&&(n="{?}",S("i18n["+e+"] no {"+r+"}: "+a,3)),o?"":n}))):"en"==n?A.v_G(e,t,"zh"):A.v_G(e,t,"en")},$T:function(){return A.v_T.apply(null,arguments)},v_T:function(){for(var e,t=arguments,n="",a=[],o=0,i=u+".i18n.$T:",s=/^([\w\-]*):/,c=0;c<t.length;c++){var f=t[c];if(0==c){if(e=s.exec(f),n=e&&e[1],!n)throw new Error(i+"0 'key:'?");f=f.substr(n.length+1)}if(-1===o)a.push(f);else{if(o)throw new Error(i+" bad args");if(0===f)o=-1;else if(r(f)){if(f<1)throw new Error(i+" bad args");o=f}else{var l=1==c?"en":c?"":"zh";if(e=s.exec(f),e&&(l=e[1]||l,f=f.substr(e[1].length+1)),!e||!l)throw new Error(i+c+" 'lang:'?");A.put({lang:l,overwrite:!1},[n+":"+f])}}}return n?o>0?n:A.v_G(n,a):""}},U=A.$T;U.G=A.get,U("NonBrowser-1::非浏览器环境，不支持{1}",1),U("IllegalArgs-1::参数错误：{1}",1),U("NeedImport-2::调用{1}需要先导入{2}",2),U("NotSupport-1::不支持：{1}",1),i.TrafficImgUrl="//ia.51.la/go1?id=20469973&pvFlag=1";var W=i.Traffic=function(e){if(t){e=e?"/"+u+"/Report/"+e:"";var n=i.TrafficImgUrl;if(n){var r=i.Traffic,a=/^(https?:..[^\/#]*\/?)[^#]*/i.exec(location.href)||[],o=a[1]||"http://file/",s=(a[0]||o)+e;if(0==n.indexOf("//")&&(n=/^https:/i.test(s)?"https:"+n:"http:"+n),e&&(n=n+"&cu="+encodeURIComponent(o+e)),!r[s]){r[s]=1;var c=new Image;c.src=n,S("Traffic Analysis Image: "+(e||u+".TrafficImgUrl="+i.TrafficImgUrl))}}}};f&&(S(U("8HO5::覆盖导入{1}",0,u),1),f.Destroy());e[u]=i})(s,i),r=function(){return s.Recorder}.call(t,n,t,e),void 0===r||(e.exports=r),"object"==a(e)&&e.exports&&(e.exports=s.Recorder)}()}).call(this,n("dc84")(e))},bed2:function(e,t,n){var r=n("5f7c");r.__esModule&&(r=r.default),"string"===typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);var a=n("967d").default;a("718397f0",r,!0,{sourceMap:!1,shadowMode:!1})},c02e:function(e,t,n){"use strict";var r=n("6a50");r("Int32",(function(e){return function(t,n,r){return e(this,t,n,r)}}))},c516:function(e,t,n){"use strict";var r=n("bed2"),a=n.n(r);a.a},cd5f:function(e,t,n){"use strict";n.r(t);var r=n("1bf6"),a=n("0e66");for(var o in a)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(o);n("c516");var i=n("828b"),s=Object(i["a"])(a["default"],r["b"],r["c"],!1,null,"7126a900",null,!1,r["a"],void 0);t["default"]=s.exports}}]);